"use strict";!function(){function r(){function r(){Array.prototype.find||(Array.prototype.find=function(r){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof r)throw new TypeError("predicate must be a function");for(var t,n=Object(this),e=n.length>>>0,o=arguments[1],i=0;e>i;i++)if(t=n[i],r.call(o,t,i,n))return t})}function t(){"function"!=typeof Object.assign&&!function(){Object.assign=function(r){if(void 0===r||null===r)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(r),n=1;n<arguments.length;n++){var e=arguments[n];if(void 0!==e&&null!==e)for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])}return t}}()}function n(){String.prototype.repeat||!function(){var r=function(){try{var r={},t=Object.defineProperty,n=t(r,r,r)&&t}catch(e){}return n}(),t=function(r){if(null==this)throw TypeError();var t=String(this),n=r?Number(r):0;if(n!=n&&(n=0),0>n||n==1/0)throw RangeError();for(var e="";n;)n%2==1&&(e+=t),n>1&&(t+=t),n>>=1;return e};r?r(String.prototype,"repeat",{value:t,configurable:!0,writable:!0}):String.prototype.repeat=t}()}return{arrayFind:r,objectAssign:t,es6String:n}}window.flatworld.generalUtils.polyfills=r()}();
"use strict";!function(){function n(){function n(n){return[].concat.apply([],n)}return{flatten2Levels:n}}window.flatworld.generalUtils.arrays=n()}();
"use strict";!function(){function n(){function n(){var n=screen.width<=640||window.matchMedia&&window.matchMedia("only screen and (max-width: 640px)").matches,t="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;return t&&n}return{isMobile:n}}window.flatworld.generalUtils.environmentDetection=n()}();
"use strict";!function(){var l=window.flatworld_libararies.loglevel;l.enableAll(),window.flatworld.log={debug:function(e,o){l.debug(o,e)}}}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,n,a){return n&&e(r.prototype,n),a&&e(r,a),r}}();!function(){var e=window.flatworld_libararies.Q,r=window.flatworld_libararies.PIXI,n=function(){function n(e){var a=arguments.length<=1||void 0===arguments[1]?{concurrency:15,crossOrigin:!1}:arguments[1];_classCallCheck(this,n);var t=a.concurrency;this.preloaderClass=new r.loaders.Loader(e,t)}return _createClass(n,[{key:"resolveOnComplete",value:function(){var r=e.defer();return this.preloaderClass.load(),this.preloaderClass.once("complete",function(e,n){r.resolve(e,n)}),r.promise}},{key:"addResource",value:function(e){this.preloaderClass.add(e)}},{key:"loadManifest",value:function(){return this}},{key:"setErrorHandler",value:function(e){return this.preloaderClass.on("error",e),this}},{key:"setProgressHandler",value:function(e){return this.preloaderClass.on("error",e),this}},{key:"activateSound",value:function(){this.preloaderClass.installPlugin()}}]),n}();window.flatworld.Preload=n}();
"use strict";!function(){function t(){function t(t){return Object.keys(t).map(function(n){return t[n]})}function n(t){var n=[];return n.concat.apply(n,t)}return{mapObjectsToArray:t,flattenArrayBy1Level:n}}window.flatworld.utils.dataManipulation=t()}();
"use strict";!function(){function t(){function t(){var t=arguments.length<=0||void 0===arguments[0]?{color:"#000000",distance:5,alpha:.5,"amgÃ¶e":45,blur:5}:arguments[0],a=new PIXI.filters.DropShadowFilter;a.color=t.color,a.distance=t.distance,a.alpha=t.alpha,a.angle=t.angle,a.blur=t.blur,this.filters=[a]}return{dropShadow:t}}window.flatworld.utils.effects=t()}();
"use strict";!function(){function e(){function e(e){var n;return e=e?e:window.event,e.buttons?n=2===+e.buttons:e.which?n=3===+e.which:e.button&&(n=2===+e.button),n?!0:!1}function n(e){return{x:e.offsetX,y:e.offsetY}}function t(e){return e.center}function o(e){var n={x:0,y:0};return e||(e=window.event),e.pageX||e.pageY?(n.x=e.pageX,n.y=e.pageY):(e.clientX||e.clientY)&&(n.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),n}return{isRightClick:e,eventData:{getPointerCoords:n,getHAMMERPointerCoords:t},eventMouseCoords:o}}function n(){function e(){function e(e){var n=e.cancelFullScreen||e.webkitCancelFullScreen||e.mozCancelFullScreen||e.exitFullscreen;if(n)n.call(e);else if("undefined"!=typeof window.ActiveXObject){var t=new ActiveXObject("WScript.Shell");null!==t&&t.SendKeys("{F11}")}}function n(e){var n=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen;if(n)n.call(e);else if("undefined"!=typeof window.ActiveXObject){var t=new ActiveXObject("WScript.Shell");null!==t&&t.SendKeys("{F11}")}return!1}var t=document.body,o=document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen;return o?e(document):n(t),!1}function n(e){return function(){var n=t();e.canvas.width=n.x,e.canvas.height=n.y}}function t(){return{x:window.innerWidth,y:window.innerHeight}}return{toggleFullScreen:e,setToFullSize:n,getWindowSize:t}}function t(){function e(e){var n=window.devicePixelRatio||1,t=e&&e.getContext("2d")||document.createElement("canvas").getContext("2d"),o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/o}return{getPixelRatio:e}}function o(){function e(e,t){return Math.abs(e)-Math.abs(t)<n}var n=.01;return{pixelEpsilonEquality:e}}window.flatworld.utils.mouse=e(),window.flatworld.utils.resize=n(),window.flatworld.utils.environmentDetection=t(),window.flatworld.utils.general=o()}();
"use strict";!function(){function t(){function t(t,n){document.addEventListener(t,n),r[t]=0}function n(t){var n;if(n=(new Date).getTime(),r[t]+e<n){for(var a=new Event(t),u=arguments.length,i=Array(u>1?u-1:0),s=1;u>s;s++)i[s-1]=arguments[s];a.customData=i,document.dispatchEvent(a),r[t]=n}}var e=50,r={};return{subscribe:t,publish:n}}window.flatworld.mapEvents=t()}();
"use strict";!function(){function t(){function t(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(!r[t]&&!r[t].size)throw new Error("eventlisteners.on needs to have detector set with this event type!");r[t].on(v("Map"+t,e)),n[t]=n[t]||new Set,n[t].add(e)}function u(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];r[t].off(e),e?n[t]["delete"](e):delete n[t]}function s(){var t,e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],r=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return t=r?n[e].has(r):!!n[e].size}function g(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments[1];e[t]=n}function o(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e[t]}function i(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];r[t]={},r[t]={on:e,off:n}}function m(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];n[t].forEach(function(e){r[t].cbOff(e)}),delete n[t],delete r[t]}function v(t,e){return function(){a.publish(t),e.apply(void 0,arguments)}}return{on:t,off:u,isOn:s,setActivityState:g,getActivityState:o,setDetector:i,clearDetector:m}}var e={},n={},r={},a=window.flatworld.mapEvents;window.flatworld.eventListeners=t()}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(){function e(e,t){var r,n=t.subcontainersConfig,i=t.subcontainerList,o=Math.floor(e.x/n.width),s=Math.floor(e.y/n.height);return i[o]=i[o]||[],r=i[o][s]=i[o][s]||[],i[o][s].length<=0&&(r=new a({x:o*n.width,y:s*n.height,width:n.width,height:n.height}),i[o][s]=r,r.x=o*n.width,r.y=s*n.height,r.visible=n.isHiddenByDefault?!1:!0),e.x-=r.x,e.y-=r.y,i[o][s].addChild(e),i[o][s]}function t(e,t){for(var r=arguments.length<=2||void 0===arguments[2]?{filter:void 0}:arguments[2],n=r.filter,i={x:t.x>=0?t.x:0,y:t.y>=0?t.y:0,width:t.width,height:t.height},a=e.getSubcontainerConfigs(),o=a.width,s=a.height,u=[],l=Math.floor(i.x/o),c=Math.floor(i.y/s),h=i.width?i.x+i.width:+i.x,f=i.height?i.y+i.height:+i.y,y=Math.floor(h/o),d=Math.floor(f/s),g=e.subcontainerList,v=l;y>=v;v++)if(v>=0&&g&&g[v])for(var b=c;d>=b;b++)if(b>=0&&g[v][b]){if(n&&!n.filterSubcontainers(g[v][b]))continue;u.push(g[v][b])}return u}var r=[],n=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{name:"",coord:{x:0,y:0},specialLayer:!1,selectable:!1}:arguments[0];_classCallCheck(this,t);var r=e.name,n=e.coord,i=e.specialLayer,a=e.selectable,o=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return Object.assign(o,n),o.name=""+r,o.specialLayer=!!i,o.selectable=a,o}return _inherits(t,e),_createClass(t,[{key:"hasSubcontainers",value:function(){return this.subcontainersConfig?!0:!1}},{key:"isCached",value:function(){return this.cacheAsBitmap}},{key:"move",value:function(e){this.x+=e.x,this.y+=e.y,this.drawThisChild=!0}},{key:"setZoom",value:function(e){return this.scale.x=this.scale.y=+e.toFixed(2),this.scale.x}},{key:"getZoom",value:function(){return this.scale.x}},{key:"getUIObjects",value:function(){return r}},{key:"emptyUIObjects",value:function(){var e=this;return r.map(function(t){e.getUILayer().removeChild(t),t=null}),r}},{key:"getPrimaryLayers",value:function(){return this.children.filter(function(e){return!e.specialLayer})}},{key:"getObjects",value:function(){var e=[];return this.hasSubcontainers()&&this.subcontainerList.forEach(function(t){e.concat(t.children)}),e}},{key:"setCache",value:function(e){var t=e?!0:!1;return this.cacheAsBitmap=t,t}},{key:"createUILayer",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"default UI layer":arguments[0],r=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],n=new t(e,r);return n.specialLayer=!0,this.addChild(n),this.UILayer=n,n}},{key:"addUIObject",value:function(e){var t;return r=r||[],t=this.getUILayer()?this.getUILayer:this.createUILayer(),this.UILayer.addChild(e),r.push(e),r}},{key:"getUILayer",value:function(){return this.UILayer}}]),t}(PIXI.Container),i=function(r){function n(){var e=arguments.length<=0||void 0===arguments[0]?{name:"",coord:{x:0,y:0},subcontainers:!1,specialLayer:!1,selectable:!1}:arguments[0];_classCallCheck(this,n);var t=e.subcontainers,r=e.selectable,i=e.specialLayer,a=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e));return a.oldAddChild=_get(Object.getPrototypeOf(n.prototype),"addChild",a).bind(a),a.subcontainersConfig=t,a.subcontainerList=[],a.selectable=r,a.specialLayer=i,a}return _inherits(n,r),_createClass(n,[{key:"addChild",value:function(t){if(this.hasSubcontainers()){var r=void 0;r=e(t,this),this.oldAddChild(r)}else this.oldAddChild(t);return t}},{key:"getSubcontainerConfigs",value:function(){return this.subcontainersConfig}},{key:"getSubcontainersByCoordinates",value:function(e){var r=arguments.length<=1||void 0===arguments[1]?{filter:void 0}:arguments[1];if(!this.hasSubcontainers())throw new Error("tried to retrieve subcontainers, when they are not present");var n,i,a=r.filter;return i=this.toLocal(new PIXI.Point(e.x,e.y)),i.width=e.width,i.height=e.height,n=t(this,i,{filter:a})}},{key:"getSubcontainers",value:function(){return this.subcontainerList}}]),n}(n),a=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return r.specialLayer=!0,r.size=e,r.selectable=!1,r}return _inherits(t,e),_createClass(t,[{key:"getSubcontainerArea",value:function(e){var t,r=arguments.length<=1||void 0===arguments[1]?{toGlobal:!0}:arguments[1];return t=r.toGlobal?this.toGlobal(new PIXI.Point(0,0)):this,e&&(t.x/=e,t.y/=e),{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(this.size.width),height:Math.round(this.size.height)}}},{key:"setCache",value:function(e){var t=e?!0:!1;return this.cacheAsBitmap=t,t}}]),t}(PIXI.Container);window.flatworld.mapLayers=window.flatworld.mapLayers||{},window.flatworld.mapLayers.MapLayer=n,window.flatworld.mapLayers.MapLayerParent=i}();
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(a,t,r){return t&&e(a.prototype,t),r&&e(a,r),a}}();!function(){var e=window.flatworld.mapLayers,a=function(){function a(t){_classCallCheck(this,a),this.rules=Array.isArray(t)?t:[t],this.layerClasses=[e.MapLayer,e.MapLayerParent]}return _createClass(a,[{key:"filterSubcontainers",value:function(e){return Array.isArray(e)?void 0:this._runRules(e)}},{key:"addRule",value:function(e){this.rules.concat(e)}},{key:"_runRules",value:function(e){var a,t=this;return this.rules.forEach(function(r){if("filter"===r.type)switch(r.object){case"container":a=t._getContainer(e,r);break;case"object":a=t._getObject(e,r)}}),a}},{key:"_getContainer",value:function(e,a){return e&&(e.parent instanceof this.layerClasses[0]||e&&e.parent instanceof this.layerClasses[1])?e.parent[a.property]===a.value:e&&e.parent&&(e.parent.parent instanceof this.layerClasses[0]||e.parent.parent instanceof this.layerClasses[0])?e.parent.parent[a.property]===a.value:void 0}},{key:"_getContainer",value:function(e,a){return e&&(e.parent instanceof this.layerClasses[0]||e&&e.parent instanceof this.layerClasses[1])?e.parent[a.property]===a.value:e&&e.parent&&(e.parent.parent instanceof this.layerClasses[0]||e.parent.parent instanceof this.layerClasses[0])?e.parent.parent[a.property]===a.value:void 0}}]),a}();window.flatworld.MapDataManipulator=a}();
"use strict";!function(){function e(e,i){var o;if(n)return n;if(!e||!i)throw new Error("UI-module requires UITheme and map object");return o=i,n={},n.showSelections=function(n,i,o){return n=t(n),1===n.length?e.highlightSelectedObject(n[0],i):n.length>1?e.showSelections(n,i):"No objects found"},n.highlightSelectedObject=function(t,n,i){e.highlightSelectedObject(t)},n.showUnitMovement=function(t,n,i,o){e.showUnitMovement(t,n,i,o)},n}function t(e){var t=e.filter(function(e){return e.highlightable===!0?!0:!1});return t}var n;window.flatworld.UI=e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();!function(){var t=(window.flatworld.utils,window.flatworld.generalUtils.arrays,function(){function t(e){_classCallCheck(this,t),this.hitDetector=e||{}}return _createClass(t,[{key:"retrieve",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?{type:!1,subcontainers:[],size:{width:0,height:0}}:arguments[1],r=n.subcontainers,a=n.size,i=n.type,o=t.globalCoords,l=(t.localCoords,[]);return r.length>0&&(r.forEach(function(t){l=l.concat(t.children)}),a.width&&a.height||(l=l.filter(function(t){if(i&&i!==t.type)return!1;var n=t.hitTest?t.hitTest(o,{hitDetector:e.hitDetector}):!0;return n}))),l}}]),t}());window.flatworld.ObjectManager=t}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();!function(){var t=window.flatworld.utils,e=window.PIXI,n=function(t){function n(){var t=arguments.length<=0||void 0===arguments[0]?{x:0,y:0}:arguments[0],e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{currentFrame:{}}:arguments[2];_classCallCheck(this,n);var o=r.currentFrame,i=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,o)),a={x:Math.round(t.x),y:Math.round(t.y)};return i.position.set(a.x,a.y),i.name="Objects_sprite_"+i.id,i.type="None",i.highlightable=!0,i.data=e,i.currentFrame=o,i.areaWidth=i.width,i.areaHeight=i.height,i}return _inherits(n,t),_createClass(n,[{key:"innerDraw",value:function(t,e){return this.fromFrame(this.currentFrame),this.x=t,this.y=e,this}},{key:"drawNewFrame",value:function(t,e,n){return this.currentFrame=n,this.innerDraw(t,e)}},{key:"getGraphicalArea",value:function(){var t,n=arguments.length<=0||void 0===arguments[0]?{toGlobal:!0}:arguments[0];return t=n.toGlobal?this.toGlobal(new e.Point(0,0)):this,{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(this.width),height:Math.round(this.height)}}},{key:"localToLocal",value:function(t,e,n){var r=this.toGlobal({x:t,y:e}),o=n.toLocal(r);return o}},{key:"clone",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?{position:!1,anchor:!1}:arguments[1],r=new e.Sprite;return r.texture=this.generateTexture(t),n.anchor&&(r.anchor=Object.assign({},this.anchor)),n.position&&(r.position=Object.assign({},this.position)),r}}]),n}(e.Sprite),r=function(t){function e(t,n,r){_classCallCheck(this,e);var o=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,n,r));return o.name="DefaultTerrainObject",o.type="terrain",o.highlightable=!1,o}return _inherits(e,t),e}(n),o=function(e){function n(t,e,r){_classCallCheck(this,n);var o=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,t,e,r));return o.name="DefaultUnitObjects",o.type="unit",o.actions={move:[],attack:[]},o}return _inherits(n,e),_createClass(n,[{key:"doAction",value:function(t){this.actions[t].forEach(function(t){t()})}},{key:"addActionType",value:function(t){this.actions[t]=this.actions[t]||[]}},{key:"addCallbackToAction",value:function(t,e){this.actions[t].push(e)}},{key:"dropShadow",value:function(){var e;return(e=t.effects).dropShadow.apply(e,arguments)}}]),n}(n);window.flatworld.objects.ObjectSprite=n,window.flatworld.objects.ObjectSpriteTerrain=r,window.flatworld.objects.ObjectSpriteUnit=o}();
"use strict";function _classCallCheck(e,l){if(!(e instanceof l))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,l){for(var n=0;n<l.length;n++){var o=l[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(l,n,o){return n&&e(l.prototype,n),o&&e(l,o),l}}();!function(){var e=window.flatworld_libararies.Q,l=window.flatworld_libararies.Howler,n=(window.flatworld.utils,window.flatworld.mapLayers,function(){function n(){_classCallCheck(this,n),this._allSounds={}}return _createClass(n,[{key:"add",value:function(e,n){var o=arguments.length<=2||void 0===arguments[2]?{loop:!1,volume:1}:arguments[2],a=o.loop,t=o.volume;return this._allSounds[e]={},this._allSounds[e]=new l({urls:[n],autoplay:!1,loop:a,volume:t}),this._allSounds[e]}},{key:"remove",value:function(e){delete this._allSounds[e]}},{key:"play",value:function(l){var n=e.defer();this._allSounds[l]._onend=function(){n.resolve(!0)},this._allSounds[l].play()}},{key:"stop",value:function(e){this._allSounds[e].stop()}},{key:"fade",value:function(l,n,o,a){var t,r=e.defer();return t=function(){r.resolve(!0)},this._allSounds[l].fade(n,o,a,t),r.promise}}]),n}());window.flatworld.Sound=n}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}();!function(){var e,n,t=function(){function t(a){_classCallCheck(this,t),n=a,e=this.addStyleElement();var r="\n        "+n.select+" {\n          z-index: 9999;\n          opacity: 0.9;\n          position: fixed;\n          left: 0px;\n          bottom: 0px;\n          background-color: brown;\n          border: 1px solid rgb(255, 186, 148);;\n          border-bottom: 0px;\n          padding:15px;\n          margin-left:10px;\n        }";this.addCSSRulesToScriptTag(e,r)}return _createClass(t,[{key:"getStyleSheetElement",value:function(){return e}},{key:"getCSSClasses",value:function(){return n}},{key:"addCSSRulesToScriptTag",value:function(e,n){e.insertRule(n,0)}},{key:"addStyleElement",value:function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}},{key:"showModal",value:function(e,n){e.classList.add(n.select)}}]),t}();window.flatworld.UITemplateBase=t}();
"use strict";!function(){function n(){function n(n){s=new Hammer.Manager(n.canvas),c=new Hamster(n.canvas),e.setDetector("fullSize",t().on,t().off),e.setDetector("fullscreen",o().on,o().off),e.setDetector("zoom",r().on,r().off),e.setDetector("drag",f().on,f().off),e.setDetector("select",i().on,i().off),n.setPrototype("setFullsize",function(){u=u||n._resizeCanvas.bind(n),e.on("fullSize",u)}),n.setPrototype("setFullScreen",function(){e.on("fullscreen",n._setFullScreen.bind(n))})}function t(){return{on:function(n){window.addEventListener("resize",n)},off:function(n){window.removeEventListener("resize",n)}}}function o(){return{on:function(n){window.addEventListener("fullscreen",n)},off:function(n){window.removeEventListener("fullscreen",n)}}}function r(){return{on:function(n){var e=new Hammer.Pinch;s.add(e),s.on("pinch",n),c.wheel(n)},off:function(n){s.on("pinch",n),c.unwheel(n)}}}function f(){return{on:function(n){var e=new Hammer.Pan({pointers:1,threshold:5,direction:Hammer.DIRECTION_ALL});s.add(e),s.on("pan",n)},off:function(n){s.off("pan",n)}}}function i(){return{on:function(n){var e=new Hammer.Tap;s.add(e),s.on("tap",n)},off:function(n){s.off("tap",n)}}}var s,c,u;return{init:n,pluginName:"baseEventlisteners"}}var e=window.flatworld.eventListeners;window.flatworld.extensions.baseEventlisteners=n()}();
"use strict";!function(){function t(){function t(t){a=r(t),n.on("drag",a)}function r(t){var r=!1;return function(i){var a;return n.getActivityState("zoom")?!1:(a=e.mouse.eventData.getHAMMERPointerCoords(i),u=!0,a.x=Math.round(a.x),a.y=Math.round(a.y),r?(i.isFinal===!0&&(r=!1,u=!1),void o(i,t,a)):(f.setOffset({x:a.x,y:a.y}),void(r=!0)))}}function o(t,n,e){var r,o;r=f.getOffset(),o={x:e.x-r.x,y:e.y-r.y},o.x>0||o.y>0||o.x<0||o.y<0?n.moveMap(o):u=!1,f.setOffset({x:e.x,y:e.y}),t.preventDefault()}function i(){function t(t){return e=t}function n(){return e}var e;return{setOffset:t,getOffset:n}}var a,f=i(),u=!1;return{init:t,pluginName:"mapDrag",_startDragListener:r}}var n=window.flatworld.eventListeners,e=window.flatworld.utils;window.flatworld.extensions.mapDrag=t()}();
"use strict";!function(){function o(){function o(o){v=o,v.setPrototype("zoomIn",i),v.setPrototype("zoomOut",a),v.setPrototype("setZoomLimits",r),v.setPrototype("setZoomModifier",n),t.on("zoom",s)}function n(o){if(!(o>0||.5>=o))throw new Error("Wrong zoom modifier! (needs to be >0 and <=0.5, given:"+o);return h=o,this}function r(o,t){return d.farther=o,d.closer=t,this}function i(o){var t=this.getZoom(),e=!0;return p(this,t,Math.abs(o)||h,e)}function a(o){var t=this.getZoom(),e=!1;return o=0>o?o:-o,p(this,t,o||-h,e)}function s(o,t,e,r){t?m(o,t,e,r):o.pointers&&(w||(w=!0,n(.5*h)),u(o))}function m(o,t,e,n){var r=n,i=v.getZoom();o.preventDefault(),r>0?v.zoomIn()&&v.moveMap(c(i,!0),c(v.getZoom(),!0)):0>r&&v.zoomOut()&&v.moveMap(c(i),c(v.getZoom()))}function u(o){var e=o.pointers,n=[{x:e[0].pageX,y:e[0].pageY},{x:e[1].pageX,y:e[1].pageY}],r=Math.abs(n[0].x-n[1].x),i=Math.abs(n[0].y-n[1].y);o.preventDefault();try{if(!l)return g={x:r,y:i},t.setActivityState("zoom",!0),void(l=!0);(4===o.eventType||8===o.eventType)&&(window.setTimeout(function(){t.setActivityState("zoom",!1)},y),l=!1),g.x+g.y<r+i?v.zoomIn()&&v.moveMap(c(v.getZoom(),!0)):v.zoomOut()&&v.moveMap(c(v.getZoom())),g={x:r,y:i}}catch(a){console.log("Error! ",a)}}function f(o,t){return t&&o>d.closer||!t&&o<d.farther?!0:!1}function c(o,t){var n=e.resize.getWindowSize(),r={x:n.x/2/o,y:n.y/2/o},i={x:r.x*(t?-h:h),y:r.y*(t?-h:h)};return i}function p(o,t,e,n){var r;return f(t,n)||(r=o.setZoom(e?t+e:t+h)),r}var v,y=40,l=!1,w=!1,g={},d={farther:.4,closer:2.5},h=.1;return{init:o,pluginName:"mapZoom"}}var t=window.flatworld.eventListeners,e=window.flatworld.utils;window.flatworld.mapEvents;window.flatworld.extensions.mapZoom=o()}();
"use strict";window.flatworld.extensions.hexagons={},window.flatworld.extensions.hexagons.utils={},window.flatworld.extensions.hexagons.eventlisteners={};
"use strict";!function(){function n(n){var t,e=arguments.length<=1||void 0===arguments[1]?"radius":arguments[1],r=arguments.length<=2||void 0===arguments[2]?3:arguments[2];return r=Math.round(r),"radius"===e&&(t=n*Math.sqrt(3)),Number(t.toFixed(r))}function t(n){var t,e=arguments.length<=1||void 0===arguments[1]?"radius":arguments[1],r=arguments.length<=2||void 0===arguments[2]?3:arguments[2];return"radius"===e&&(t=2*n),Number(t.toFixed(r))}function e(n){var t,e=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],a=arguments.length<=2||void 0===arguments[2]?{x:0,y:0}:arguments[2];return t=n.map(function(n){return{x:n.x+a.x,y:n.y+a.y}}),r(e,t)}function r(n,t){for(var e,r,a,u,s,g=n.x,o=n.y,i=!1,l=0,m=t.length-1;l<t.length;m=l++)e=t[l].x,a=t[l].y,r=t[m].x,u=t[m].y,s=a>o!=u>o&&(r-e)*(o-a)/(u-a)+e>g,s&&(i=!i);return i}window.flatworld.extensions.hexagons.utils.calcShortDiagonal=n,window.flatworld.extensions.hexagons.utils.calcLongDiagonal=t,window.flatworld.extensions.hexagons.utils.hexaHitTest=e}();
"use strict";!function(){function n(n){var t=(arguments.length<=1||void 0===arguments[1]?{isFlatTop:!1}:arguments[1],[]);return t=e(n),new PIXI.Polygon(t)}function t(n){var t=arguments.length<=1||void 0===arguments[1]?{color:"#000000",isFlatTop:!1}:arguments[1],o=new PIXI.Graphics,a=e(n);return o.beginFill(t.color,1),o.drawPolygon(a),o.endFill(),o}function e(n){return o(n).map(function(n){return new PIXI.Point(n.x,n.y)})}function o(n){var t=arguments.length<=1||void 0===arguments[1]?{isFlatTop:!1,precision:3}:arguments[1],e=t.isFlatTop?0:.5,o={x:n,y:n},a=2*Math.PI/6*e,r=o.x*Math.cos(a),s=o.y*Math.sin(a),i=[];i.push({x:r,y:s});for(var u=1;7>u;u++)a=2*Math.PI/6*(u+e),r=o.x*Math.cos(a),s=o.y*Math.sin(a),i.push({x:r,y:s});return i}window.flatworld.extensions.hexagons.utils.createHexagon=n,window.flatworld.extensions.hexagons.utils.createVisibleHexagon=t}();
"use strict";!function(){function t(t){function i(n){var o,i,w=e.mouse.eventData.getHAMMERPointerCoords(n),s={allData:function(t){return t.data.typeData}};i=new r({type:"filter",object:"container",property:"name",value:"unitLayer"}),o=t.getObjectsUnderArea(w,{filter:i}),o=e.dataManipulation.mapObjectsToArray(o),o=e.dataManipulation.flattenArrayBy1Level(o),o.length&&a.publish("objectsSelected",o),l.showSelections(o,s),t.drawOnNextTick()}var l;if(!t)throw new Error("eventlisteners initialization require map arguments");return l=n(),o.on("select",i),!0}var e=window.flatworld.utils,a=window.flatworld.mapEvents,n=window.flatworld.UI,r=window.flatworld.MapDataManipulator,o=window.flatworld.eventListeners;window.flatworld.extensions.hexagons.setupHexagonClick=t}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(){function t(t){if(!t)throw new Error("Need radius!");var n=Math.round(s(t)),r=Math.round(c(t)),o=Math.round(t.toFixed(3));this.anchor.set(.5,.5),this.areaHeight=this.HEIGHT=n,this.areaWidth=this.WIDTH=r,this.SIDE=o,this.ROW_HEIGHT=Math.round(.75*n),this.hitArea=e(t),this.hitTest=function(t,e){this.updateTransform();var n=e.hitDetector.processInteractive(new PIXI.Point(t.x,t.y),this,function(){console.log("Shouldn't get here, the object should be non-interactive")},!0,!0);return n}}function e(t){return n||(n=u(t)),n}var n,r=window.flatworld.objects,o=r.ObjectSpriteTerrain,i=r.ObjectSpriteUnit,a=window.flatworld.extensions.hexagons.utils,s=a.calcLongDiagonal,c=a.calcShortDiagonal,u=a.createHexagon,l=function(e){function n(e,r,o){_classCallCheck(this,n);var i=o.radius,a=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,r,o));return a.name="DefaultTerrainObject_hexa",t.call(a,i),a}return _inherits(n,e),n}(o),h=function(e){function n(e,r,o){_classCallCheck(this,n);var i=o.radius,a=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,r,o));return a.name="DefaultUnitObjects_hexa",t.call(a,i),a}return _inherits(n,e),n}(i);window.flatworld.extensions.hexagons.objects={ObjectHexaTerrain:l,ObjectHexaUnit:h}}();
"use strict";!function(){function n(){function n(n){o=n,t(o)}function t(n){return e(n)}var o={};return{init:n,pluginName:"selectHexagonObject"}}var e=window.flatworld.extensions.hexagons.setupHexagonClick;window.flatworld.extensions.hexagons.selectHexagonObject=n()}();
"use strict";!function(){function t(){function t(t){g=t,f=g.getZoom(),a(),o(),g.drawOnNextTick(),window.FlaTWorld_mapMovement_subCheck=function(){g.getPrimaryLayers().forEach(function(t){var n,e,a=i.flatten2Levels(t.getSubcontainers());n=a.filter(function(t){return t.visible}),e=a.filter(function(t){return!t.visible}),console.log("visible subcontainers: "+n.length+":"+n,"\n\ninvisible: "+e.length+":"+e)})},window.FlaTWorld_mapMovement_deactivate=function(){g.getPrimaryLayers().forEach(function(t){var n,e=i.flatten2Levels(t.getSubcontainers());n=e.forEach(function(t){t.visible=!1})})}}function a(){var t;t=g.getViewportArea(),Object.assign(t,u(t)),Object.assign(t,s(t,f)),g.getPrimaryLayers().forEach(function(n){var e=i.flatten2Levels(n.getSubcontainers());e.forEach(function(n){n.visible=h(n,t,!1)?!1:!0})})}function r(){function t(t,n){var e,i,a,r;e=g.getViewportArea(),i=c(e,.5),Object.assign(e,c(e)),a=s(e),r=s(i),d(a,r)}if(M.processing)return!1;M.processing=!0;var n=t(M,v);window.setTimeout(n,w)}function o(){function t(t){var n=t.customData[0];v.width+=n.x,v.height+=n.y,r(g)}function n(){r(g)}function i(t){f=t.customData[0].newScale}e.subscribe("mapMoved",t),e.subscribe("mapResized",n),e.subscribe("mapZoomed",i)}function h(t,e){var i,a,r=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];return a=t.getSubcontainerArea(f,{toGlobal:r}),i=!n(a,e)}function u(t){var n=Math.abs(t.width*l*2);return{x2:Math.round(t.x+Math.abs(t.width)+n),y2:Math.round(t.y+Math.abs(t.height)+n),width:Math.round(t.width+n),height:Math.round(t.height+n)}}function s(t){return{x:Math.round(t.x/f),y:Math.round(t.y/f),x2:Math.round(t.x2/f),y2:Math.round(t.y2/f),width:Math.round(t.width/f),height:Math.round(t.height/f)}}function d(t,n){var e,a=[];e=Object.assign({},t),e.width+=Math.round(Math.abs(v.width)),e.height+=Math.round(Math.abs(v.height)),v.width=0,v.height=0,a=g.getPrimaryLayers().map(function(t){return t.getSubcontainersByCoordinates(e)}),a=i.flatten2Levels(a),a.forEach(function(t){h(t,n,!0)?t.visible=!1:t.visible=!0}),M.processing=!1,g.drawOnNextTick()}function c(t,n){var e=Math.abs(t.width*l);return n=n||1,{x:Math.round(t.x-e*n),y:Math.round(t.y-e*n),x2:Math.round(t.x+Math.abs(t.width)+e*n),y2:Math.round(t.y+Math.abs(t.height)+e*n),width:Math.round(t.width+2*e*n),height:Math.round(t.height+2*e*n)}}function s(t){return{x:Math.round(t.x/f),y:Math.round(t.y/f),x2:Math.round(t.x2/f),y2:Math.round(t.y2/f),width:Math.round(t.width/f),height:Math.round(t.height/f)}}var g,f,l=.8,w=20,M={},v={width:0,height:0};return{init:t,pluginName:"mapMovement",addAll:a,check:r,startEventListeners:o}}function n(t,n){return t.x<=n.x+n.width&&n.x<=t.x+t.width&&t.y<=n.y+n.height&&n.y<=t.y+t.height}var e=window.flatworld.mapEvents,i=window.flatworld.generalUtils.arrays;new Worker("/components/map/extensions/mapMovement/mapMovementWorker.js");window.flatworld.extensions.mapMovement=t()}();
"use strict";window.flatworld.UIs=window.flatworld.UIs||{},window.flatworld.UIs["default"]={},window.flatworld.UIs["default"].utils={},window.flatworld.UIs["default"].layout={};
"use strict";!function(){window.flatworld.UIs["default"].utils=window.flatworld.UIs["default"].utils||{},window.flatworld.UIs["default"].utils.drawShapes=function(){function t(t,a,e,n,o,i,s,r,h){function f(t,a,e,n,o,i,s,r){var h;switch(a=+a,e=+e,n=+n,o=+o,i=+i,s=+s,t.beginStroke("#F00").moveTo(a,e).lineTo(n,o).lineTo(i,s),r){case 0:h=Math.sqrt((i-a)*(i-a)+(s-e)*(s-e)),t.arcTo(n,o,a,e,.55*h),t.fill();break;case 1:t.beginStroke("#F00").moveTo(a,e).lineTo(n,o).lineTo(i,s).lineTo(a,e).fill();break;case 2:break;case 3:var f=(a+n+i)/3,M=(e+o+s)/3;t.beginFill().quadraticCurveTo(f,M,a,e);break;case 4:var d,c,l,u,p=5;if(i===a)h=s-e,d=(n+a)/2,l=(n+a)/2,c=o+h/p,u=o-h/p;else{h=Math.sqrt((i-a)*(i-a)+(s-e)*(s-e));var y=(a+i)/2,v=(e+s)/2,b=(y+n)/2,T=(v+o)/2,g=(s-e)/(i-a),w=h/(2*Math.sqrt(g*g+1))/p,I=g*w;d=b-w,c=T-I,l=b+w,u=T+I}t.bezierCurveTo(d,c,l,u,a,e),t.fill()}}var M,d,c,l,u,p,y=t.graphics,v="#000";"string"==typeof a&&(a=parseInt(a,10)),"string"==typeof e&&(e=parseInt(e,10)),"string"==typeof n&&(n=parseInt(n,10)),"string"==typeof o&&(o=parseInt(o,10)),i="undefined"!=typeof i?i:3,s="undefined"!=typeof s?s:1,r="undefined"!=typeof r?r:Math.PI/8,h="undefined"!=typeof h?h:10;var b,T,g,w,I="function"!=typeof i?f:i,k=Math.sqrt((n-a)*(n-a)+(o-e)*(o-e)),q=(k-h/3)/k;1&s?(b=Math.round(a+(n-a)*q),T=Math.round(e+(o-e)*q)):(b=n,T=o),2&s?(g=a+(n-a)*(1-q),w=e+(o-e)*(1-q)):(g=a,w=e),y.beginStroke(v).moveTo(g,w).lineTo(b,T);var P=Math.atan2(o-e,n-a),S=Math.abs(h/Math.cos(r));return 1&s&&(M=P+Math.PI+r,d=n+Math.cos(M)*S,c=o+Math.sin(M)*S,l=P+Math.PI-r,u=n+Math.cos(l)*S,p=o+Math.sin(l)*S,I(y,d,c,n,o,u,p,i)),2&s&&(M=P+r,d=a+Math.cos(M)*S,c=e+Math.sin(M)*S,l=P-r,u=a+Math.cos(l)*S,p=e+Math.sin(l)*S,I(y,d,c,a,e,u,p,i)),!0}function a(a,e,n,o,i,s,r,h,f,M,d){var c,l,u,p,y;h="undefined"!=typeof h?h:3,f="undefined"!=typeof f?f:1,M="undefined"!=typeof M?M:Math.PI/8,d="undefined"!=typeof d?d:10,a.beginPath(),a.arc(e,n,o,i,s,r),a.stroke(),a.strokeStyle="rgba(0,0,0,0)",1&f&&(c=Math.cos(i)*o+e,l=Math.sin(i)*o+n,u=Math.atan2(e-c,l-n),r?(p=c+10*Math.cos(u),y=l+10*Math.sin(u)):(p=c-10*Math.cos(u),y=l-10*Math.sin(u)),t(a,c,l,p,y,h,2,M,d)),2&f&&(c=Math.cos(s)*o+e,l=Math.sin(s)*o+n,u=Math.atan2(e-c,l-n),r?(p=c-10*Math.cos(u),y=l-10*Math.sin(u)):(p=c+10*Math.cos(u),y=l+10*Math.sin(u)),t(a,c,l,p,y,h,2,M,d))}return{normal:t,arced:a}}()}();
"use strict";!function(){var l=window.flatworld_libararies.Handlebars;window.flatworld.UIs=window.flatworld.UIs||{},window.flatworld.UIs["default"]=window.flatworld.UIs["default"]||{},window.flatworld.UIs["default"].templates={multiSelection:l.compile("\n      <span style='font-size:200%;display:block;margin-bottom:20px;'>\n        {{title}}\n      </span>\n      <ul>\n        {{#each objects}}\n        <li>\n          {{this.data.typeData.name}}\n        </li>\n        {{/each}}\n      </ul>"),singleSelection:l.compile("\n      <span style='font-size:200%;display:block;margin-bottom:20px;'>\n        {{title}}\n      </span>\n      <ul>\n        <li>\n          {{object.name}}\n        </li>\n      </ul>")}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}();!function(){function e(e){if(!r[e]){var t=$(l[e]);r[e]=t}return r[e]}var t=window.flatworld.UIs["default"].templates,o=window.flatworld.extensions.hexagons.utils.createVisibleHexagon,n=window.flatworld.UITemplateBase,a=(window.flatworld.UI,"slow"),l={select:"#dialog_select"},r={},i=function(n){function r(e,t){var o=arguments.length<=2||void 0===arguments[2]?{styles:"#F0F0F0"}:arguments[2];_classCallCheck(this,r);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,l));return n.map=t,n.modal=e||document.getElementById("dialog_select"),n.styles=o.styles,n}return _inherits(r,n),_createClass(r,[{key:"getTemplates",value:function(){return t}},{key:"showSelections",value:function(o,n,r){var i,s=this,c=this.map.drawOnNextTick.bind(this.map),u=this.map.getMovableLayer();i=o&&o.length>1?function(){s.modal.innerHTML=t.multiSelection({title:"Objects",objects:o}),s.showModal(s.modal,l),console.log(o),e("select").fadeIn(a)}:1===o.length?function(){s.highlightSelectedObject(o[0]),console.log(o)}:function(){u.emptyUIObjects(),c(),console.log("Error occured selecting the objects on this coordinates! Nothing found")},e("select").fadeOut(a,i)}},{key:"highlightSelectedObject",value:function(o,n){var r,i,s=arguments.length<=2||void 0===arguments[2]?{shadow:{color:"0x0000",distance:5,alpha:.55,angle:45,blur:5}}:arguments[2],c=s.shadow;return i=n.allData(o),this.modal.innerHTML=t.singleSelection({title:"Selected",object:{name:i.name}}),this.showModal(this.modal,l),r=this._highlightSelectedObject(o,this.map.getRenderer()),r.dropShadow({color:c.color,distance:c.distance,alpha:c.alpha,angle:c.angle,blur:c.blur}),this.map.drawOnNextTick(),e("select").fadeIn(a),r}},{key:"showUnitMovement",value:function(){}},{key:"init",value:function(){}},{key:"_highlightSelectedObject",value:function(e,t){var o,n=this.map.getMovableLayer();o=e.clone(t),o.__proto__=e.__proto__;var a=e.toGlobal(new PIXI.Point(0,0));return a=n.toLocal(a),a.x-=e.width*e.anchor.x,a.y-=e.height*e.anchor.y,this.createHighlight(o,{coords:a}),o}},{key:"createHighlight",value:function(e){var t,n=arguments.length<=1||void 0===arguments[1]?{coords:new PIXI.Point(0,0)}:arguments[1],a=47,l=this.map.getMovableLayer(),r=new this.map.createSpecialLayer("UILayer",{toLayer:l}),i={x:Number(e.x),y:Number(e.y)};t=o(a,{color:"#F0F0F0"}),t.x=i.x+32,t.y=i.y+27,t.alpha=.5,r.addChild(t),r.addChild(e),r.position=n.coords,this.map.removeUIObject(this.map.layerTypes.movableType.id,[r]),this.map.addUIObjects(this.map.layerTypes.movableType.id,[r])}}]),r}(n);window.flatworld.UIs["default"].init=i}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(){function e(e,t){t?n.children.forEach(function(t){if(!t.isCached())return!1;var n=t.getSubcontainers();n.forEach(function(t){t.setCache(e)})}):n.children.forEach(function(t){return t.isCached()?void t.setCache(e):!1})}var t,n,a,r,i=window.flatworld_libararies.Q,o=window.flatworld.mapLayers,u=(window.flatworld.Objects,window.flatworld.ObjectManager),s=window.flatworld.mapEvents,l=window.flatworld.utils,c=window.flatworld.MapDataManipulator,g=0,h=1,d="0.0.1",y=!1,v=[],f=function(){function f(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],i=arguments.length<=1||void 0===arguments[1]?{bounds:{width:0,height:0},rendererOptions:{refreshEventListeners:!0},subcontainers:!1,cache:!1,trackFPSCB:!1}:arguments[1];_classCallCheck(this,f);var s=i.bounds,l=i.rendererOptions,c=i.subcontainers,y=i.trackFPSCB,v=i.cache;if(!e)throw new Error(this.constructor.name+" needs canvasContainer!");"string"==typeof e&&(e=document.querySelector(e)),a=PIXI.autoDetectRenderer(s.width,s.height,l),a.plugins.interaction.destroy(),e.innerHTML="",e.appendChild(a.view,e),r=c?o.MapLayerParent:o.MapLayer,t=new o.MapLayer({name:"staticLayer",coord:{x:0,y:0}}),n=new o.MapLayer({name:"movableLayer",coord:{x:0,y:0}}),t.addChild(n),a.view.style.position="absolute",a.view.style.display="block",a.view.style.left="0px",a.view.style.top="0px",document.getElementsByTagName("body")[0].style.overflow="hidden",a.roundPixels=!0,this.canvas=a.view,this.plugins=new Set,this.subcontainersConfig=c,this.trackFPSCB=y,this.objectManager=new u(new PIXI.interaction.InteractionManager(a)),this.cache=v,this.layerTypes={staticType:{id:g,layer:t},movableType:{id:h,layer:n}},this.VERSION=d}return _createClass(f,[{key:"init",value:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],a=arguments.length<=2||void 0===arguments[2]?null:arguments[2],r=arguments.length<=3||void 0===arguments[3]?{fullsize:!0}:arguments[3],i=[];return r.fullsize&&this.toggleFullsize(),e.length&&(i=this.activatePlugins(e)),t&&Object.assign(n,t),this._defaultTick(),a&&this.customTickOn(a),v=i,this.cache&&this.cacheMap(),this.drawOnNextTick(),i||Promise.resolve()}},{key:"whenReady",value:function(){return i.all(v)}},{key:"drawOnNextTick",value:function(){y=!0}},{key:"addUIObject",value:function(e,t){switch(e){case g:this.getStaticLayer().addUIObject(t);break;case h:this.getMovableLayer().addUIObject(t)}}},{key:"removeUIObject",value:function(e,t){switch(e){case g:this.getStaticLayer().emptyUIObjects();break;case h:this.getMovableLayer().emptyUIObjects()}}},{key:"addUIObjects",value:function(e,t){var n=this;t.forEach(function(t){n.addUIObject(e,t)})}},{key:"createSpecialLayer",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"default special layer":arguments[0],t=arguments.length<=1||void 0===arguments[1]?{coord:{x:0,y:0},toLayer:toLayer}:arguments[1],n=t.coord||{x:0,y:0},a=new o.MapLayer(e,n);return a.specialLayer=!0,t.toLayer&&t.toLayer.addChild(a),a}},{key:"addLayer",value:function(e){var t;return this.getSubcontainerConfigs()&&e.subcontainers!==!1&&(e.subcontainers=this.getSubcontainerConfigs()),t=new r(e),this.getMovableLayer().addChild(t),t}},{key:"usesSubcontainers",value:function(){return this.getSubcontainerConfigs()?!0:!1}},{key:"getSubcontainerConfigs",value:function(){return this.subcontainersConfig}},{key:"getViewportArea",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=e?this.getMovableLayer():this.getStaticLayer();return{x:t.x,y:t.y,width:Math.round(window.innerWidth),height:Math.round(window.innerHeight)}}},{key:"removeLayer",value:function(e){return n.removeChild(e),e}},{key:"moveMap",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{x:0,y:0}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?e:arguments[1],a={x:Math.round(e.x/this.getStaticLayer().getZoom()),y:Math.round(e.y/this.getStaticLayer().getZoom())};n.move(a),s.publish("mapMoved",t||a),this.drawOnNextTick()}},{key:"isCacheActivated",value:function(){return this.cache}},{key:"cacheMap",value:function(t){e(!0,this.usesSubcontainers())}},{key:"unCacheMap",value:function(){e(!1,this.usesSubcontainers())}},{key:"activatePlugins",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],n=[];return t.forEach(function(t){if("object"!==("undefined"==typeof t?"undefined":_typeof(t)))throw new Error("problem with initializing a plugin");e.activatePlugin(t)}),n}},{key:"activatePlugin",value:function(e){try{if(!e||!e.pluginName||!e.init)throw new Error("plugin, plugin.pluginName or plugin.init import is missing!");this.plugins.add(e[e.pluginName])&&e.init(this)}catch(t){console.log("An error initializing plugin. JSON.stringify: '"+JSON.stringify(e)+"' ",t)}}},{key:"setPrototype",value:function(e,t){var n=Object.getPrototypeOf(this);n[e]=t}},{key:"getObjectsUnderArea",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{x:0,y:0,width:0,height:0}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{filter:void 0}:arguments[1],n=t.filter,a={globalCoords:e,localCoords:this.getMovableLayer().toLocal(new PIXI.Point(e.x,e.y))},r={};if(a.localCoords.width=e.width,a.localCoords.height=e.height,n){var i=new c({type:"filter",object:"container",property:"selectable",value:!0});n.addRule(i)}if(this.usesSubcontainers()){var o=this._getSubcontainersUnderArea(a,{filter:n});r=this._retrieveObjects(a,{subcontainers:o})}return r}},{key:"getPrimaryLayers",value:function(){return this.getMovableLayer().getPrimaryLayers()}},{key:"getMapCoordinates",value:function(){return{x:this.getMovableLayer().x,y:this.getMovableLayer().y}}},{key:"getZoomLayer",value:function(){return this.getStaticLayer()}},{key:"setZoom",value:function(e){return s.publish("mapZoomed",{previousScale:this.getZoom(),newScale:e}),this.getZoomLayer().setZoom(e)}},{key:"getZoom",value:function(){return this.getZoomLayer().getZoom()}},{key:"getMovableLayer",value:function(){return n}},{key:"getRenderer",value:function(){return a}},{key:"getStaticLayer",value:function(){return t}},{key:"zoomIn",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"zoomOut",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"toggleFullsize",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"toggleFullScreen",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"_retrieveObjects",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{type:"",subcontainers:[]}:arguments[1];return this.objectManager.retrieve(e,{type:t.type,subcontainers:t.subcontainers,size:{width:e.globalCoords.width,height:e.globalCoords.height}})}},{key:"_getLayersWithAttributes",value:function(e,t){return this.getMovableLayer().children[0].children.filter(function(n){return n[e]===t})}},{key:"_getSubcontainersUnderArea",value:function(e){var t,n=arguments.length<=1||void 0===arguments[1]?{filter:void 0}:arguments[1],a=this.getMovableLayer().getPrimaryLayers(),r=[],i=n.filter;return a.forEach(function(n){t=n.getSubcontainersByCoordinates(e.globalCoords,{filter:i}),r=r.concat(t)}),r}},{key:"_setFullScreen",value:function(){l.resize.toggleFullScreen(),s.publish("mapResized"),this._resizeCanvas()}},{key:"_resizeCanvas",value:function(){var e=l.resize.getWindowSize();a.autoResize=!0,a.resize(e.x,e.y),s.publish("mapResized"),this.drawOnNextTick()}},{key:"_defaultTick",value:function(){var e,n,r=1e3,i=0,o=(new Date).getTime();PIXI.ticker.shared.add(function(){y===!0&&(this.trackFPSCB&&(e=(new Date).getTime()),a.render(t),y=!1,this.trackFPSCB&&(n+=Math.round(Math.abs(e-(new Date).getTime())))),this.trackFPSCB&&(i++,o+r<(new Date).getTime()&&(this.trackFPSCB({FPS:i,FPStime:o,renderTime:n,drawCount:a.drawCount}),i=0,n=0,o=(new Date).getTime()))}.bind(this))}}]),f}();window.flatworld.Flatworld=f}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(){function e(e,c){var l=arguments.length<=2||void 0===arguments[2]?{trackFPSCB:!1,isHiddenByDefault:!0,cache:!1}:arguments[2];console.log("============== Horizontal hexagonal Map factory started =============");var s,d,y,f=i.environmentDetection.getPixelRatio(),p="string"==typeof c.map?JSON.parse(c.map):c.map,u="string"==typeof c.type?JSON.parse(c.type):c.type,w="string"==typeof c.game?JSON.parse(c.game):c.game,m=i.resize.getWindowSize(),h=(w.mapSize,{refreshEventListeners:!0}),g={ObjectTerrain:a.objects.ObjectHexaTerrain,ObjectUnit:a.objects.ObjectHexaUnit},b={bounds:{x:0,y:0,width:m.x,height:m.y},rendererOptions:{resolution:f,autoResize:!0,transparent:!0,antialias:!1},subcontainers:{width:500,height:500,maxDetectionOffset:100,isHiddenByDefault:l.isHiddenByDefault},trackFPSCB:l.trackFPSCB,cache:l.cache};return s=new r(e,b,h),d=document.getElementById("selectionDialog"),y=new o(d,s),n(y,s),p.layers.forEach(function(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw console.log("Problem in horizontalHexaFactory, with layerData:",e),new Error("Problem in horizontalHexaFactory, with layerData:",e);var o,a=(e.group,s.objectManager,s.getRenderer()),r={name:e.name,coord:e.coord,drawOutsideViewport:{x:a.width,y:a.height},selectable:"unitLayer"===e.name?!0:!1};try{o=s.addLayer(r),e.objectGroups.forEach(function(e){var a=e.typeImageData;return a?void e.objects.forEach(function(r){var n,i,c,l,s;try{if(n=u.objectData[a][r.objType],!n)throw console.debug("Bad mapData for type:",a,r.objType,r.name),new Error("Bad mapData for type:",a,r.objType,r.name);i={typeData:n,activeData:r.data},l=t.Texture.fromFrame(n.image),c={currentFrame:l,radius:w.hexagonRadius},s=new g[e.type](r.coord,i,c),o.addChild(s)}catch(d){console.log(d)}}):void console.log("Error with spritesheetType-data")})}catch(n){console.log("Problem:",e.type,n.stack)}}),s.moveMap(p.startPoint),s}var t=window.flatworld_libararies.PIXI,o=window.flatworld.UIs["default"].init,a=window.flatworld.extensions.hexagons,r=window.flatworld.Flatworld,n=window.flatworld.UI,i=window.flatworld.utils;window.flatworld.factories.hexaFactory=e}();
//# sourceMappingURL=flatworld.min.js.map
