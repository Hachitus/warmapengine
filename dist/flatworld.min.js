"use strict";!function(){window.flatworld_libraries={},window.flatworld_libraries.PIXI=window.PIXI,window.flatworld_libraries.Q=window.Q,window.flatworld_libraries.Hammer=window.Hammer,window.flatworld_libraries.Hamster=window.Hamster,window.flatworld_libraries.Handlebars=window.Handlebars,window.flatworld_libraries.log=window.log,window.flatworld_libraries.Howler=window.Howl,window.flatworld={},window.flatworld.generalUtils={},window.flatworld.log={},window.flatworld.objects={},window.flatworld.extensions={},window.flatworld.mapLayers={},window.flatworld.utils={},window.flatworld.factories={},window.flatworld.UIs={},window.flatworld.UIs["default"]={}}();
"use strict";!function(){var r=window.flatworld_libraries.log;r.enableAll(),window.flatworld.log={debug:function(o,l){r.debug(l,o)},error:function(o,l){r.error(l,o)}}}();
"use strict";!function(){function r(){function r(){Array.prototype.find||(Array.prototype.find=function(r){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof r)throw new TypeError("predicate must be a function");for(var t,n=Object(this),o=n.length>>>0,e=arguments[1],i=0;o>i;i++)if(t=n[i],r.call(e,t,i,n))return t})}function t(){"function"!=typeof Object.assign&&!function(){Object.assign=function(r){if(void 0===r||null===r)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(r),n=1;n<arguments.length;n++){var o=arguments[n];if(void 0!==o&&null!==o)for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t}}()}function n(){String.prototype.repeat||!function(){var r=function(){try{var r={},t=Object.defineProperty,n=t(r,r,r)&&t}catch(o){}return n}(),t=function(r){if(null==this)throw TypeError();var t=String(this),n=r?Number(r):0;if(n!=n&&(n=0),0>n||n==1/0)throw RangeError();for(var o="";n;)n%2==1&&(o+=t),n>1&&(t+=t),n>>=1;return o};r?r(String.prototype,"repeat",{value:t,configurable:!0,writable:!0}):String.prototype.repeat=t}()}return{arrayFind:r,objectAssign:t,es6String:n}}window.flatworld.generalUtils.polyfills=r()}();
"use strict";!function(){function n(){function n(n){return[].concat.apply([],n)}function r(n,r){for(var t=[],e=0;e<n.length;e+=r)t.push(n.slice(e,r+e));return t}return{flatten2Levels:n,chunkArray:r}}window.flatworld.generalUtils.arrays=n()}();
"use strict";!function(){function n(){function n(){var n=screen.width<=640||window.matchMedia&&window.matchMedia("only screen and (max-width: 640px)").matches,t="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;return t&&n}return{isMobile:n,isTouchDevice:t}}function t(){return"ontouchstart"in document.documentElement}window.flatworld.generalUtils.environmentDetection=n()}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,n,a){return n&&e(r.prototype,n),a&&e(r,a),r}}();!function(){var e=window.flatworld_libraries,r=e.Q,n=e.PIXI,a=function(){function e(r){var a=arguments.length<=1||void 0===arguments[1]?{concurrency:15,crossOrigin:!1}:arguments[1];_classCallCheck(this,e);var o=a.concurrency;this.preloaderClass=new n.loaders.Loader(r,o)}return _createClass(e,[{key:"resolveOnComplete",value:function(){var e=r.defer();return this.preloaderClass.load(),this.preloaderClass.once("complete",function(r,n){e.resolve(r,n)}),e.promise}},{key:"addResource",value:function(e){this.preloaderClass.add(e)}},{key:"loadManifest",value:function(){return this}},{key:"setErrorHandler",value:function(e){return this.preloaderClass.on("error",e),this}},{key:"setProgressHandler",value:function(e){return this.preloaderClass.on("error",e),this}},{key:"activateSound",value:function(){this.preloaderClass.installPlugin()}}]),e}();window.flatworld.Preload=a}();
"use strict";!function(){function t(){function t(t){return Object.keys(t).map(function(n){return t[n]})}function n(t){var n=[];return n.concat.apply(n,t)}return{mapObjectsToArray:t,flattenArrayBy1Level:n}}window.flatworld.utils.dataManipulation=t()}();
"use strict";!function(){function l(){function l(){var l=arguments.length<=0||void 0===arguments[0]?{color:"#000000",distance:5,alpha:.5,"amgÃ¶e":45,blur:5}:arguments[0],a=new r.filters.DropShadowFilter;a.color=l.color,a.distance=l.distance,a.alpha=l.alpha,a.angle=l.angle,a.blur=l.blur,this.filters=[a]}return{dropShadow:l}}var r=window.flatworld_libraries.PIXI;window.flatworld.utils.effects=l()}();
"use strict";!function(){function e(){function e(e){var n;return e=e?e:window.event,e.buttons?n=2===+e.buttons:e.which?n=3===+e.which:e.button&&(n=2===+e.button),!!n}function n(e){return{x:e.offsetX,y:e.offsetY}}function t(e){return e.center}function o(e){var n={x:0,y:0};return e||(e=window.event),e.pageX||e.pageY?(n.x=e.pageX,n.y=e.pageY):(e.clientX||e.clientY)&&(n.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),n}return{isRightClick:e,eventData:{getPointerCoords:n,getHAMMERPointerCoords:t},eventMouseCoords:o}}function n(){function e(){function e(e){var n=e.cancelFullScreen||e.webkitCancelFullScreen||e.mozCancelFullScreen||e.exitFullscreen;if(n)n.call(e);else if("undefined"!=typeof window.ActiveXObject){var t=new ActiveXObject("WScript.Shell");null!==t&&t.SendKeys("{F11}")}}function n(e){var n=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen;if(n)n.call(e);else if("undefined"!=typeof window.ActiveXObject){var t=new ActiveXObject("WScript.Shell");null!==t&&t.SendKeys("{F11}")}return!1}var t=document.body,o=document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen;return o?e(document):n(t),!1}function n(e){return function(){var n=t();e.canvas.width=n.x,e.canvas.height=n.y}}function t(){return{x:window.innerWidth,y:window.innerHeight}}return{toggleFullScreen:e,setToFullSize:n,getWindowSize:t}}function t(){function e(e){var n=window.devicePixelRatio||1,t=e&&e.getContext("2d")||document.createElement("canvas").getContext("2d"),o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/o}return{getPixelRatio:e}}function o(){function e(e,t){return Math.abs(e)-Math.abs(t)<n}var n=.01;return{pixelEpsilonEquality:e}}window.flatworld.utils.mouse=e(),window.flatworld.utils.resize=n(),window.flatworld.utils.environmentDetection=t(),window.flatworld.utils.general=o()}();
"use strict";!function(){function n(){function n(n,t){i[n]&&o.error("API endpoint for fetch not found: "+name+", "+t?t[0]:"no params");var r=i[n];return i[n].cbs.forEach(function(n){r=n("get",r,t)}),fetch(r.url).then(function(n){return n.json()}).then(function(n){o.debug("parsed json",n)})["catch"](function(n){o.debug("parsing failed",n)})}function t(n,t){if(!i[n])return void o.error("API endpoint for fetch not found: "+n+", "+(t?t[0]:"no params"));var r=i[n];i[n].cbs.forEach(function(n){r=n("post",r,t)}),fetch(r.url,{body:r.body}).then(function(n){return n.json()}).then(function(n){o.debug("parsed json",n)})["catch"](function(n){o.debug("parsing failed",n)})}function r(n,t,r){i[n]&&o.error("API endpoint already exists and has been defined "+n+", "+r+", "+JSON.stringify(t)),i[n]={baseUrl:r,cbs:t?[t]:[]}}function e(n,t){i[n]||o.error("API endpoint not found for removing!"),delete i[n]}function f(n,t,r){i[n]&&i[n].cbs||o.error("API endpoint not found for updating!"),i[n].cbs.push(t)}var i={};return{get:n,post:t,add:r,remove:e,update:f}}var o=window.flatworld.log;window.flatworld.mapAPI=n()}();
"use strict";!function(){function t(){function t(t,n){document.addEventListener(t,n),i[t]=0}function e(t){var e;if(e=(new Date).getTime(),i[t]+r<e){var a=void 0;a=n(t);for(var c=arguments.length,u=Array(c>1?c-1:0),o=1;c>o;o++)u[o-1]=arguments[o];a.customData=u,document.dispatchEvent(a),i[t]=e}}var r=50,i={};return{subscribe:t,publish:e}}function n(t){var n;try{n=new Event(t)}catch(e){n=document.createEvent("Event"),n.initEvent(t,!0,!0)}return n}window.flatworld.mapEvents=t()}();
"use strict";!function(){function t(){function t(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(!o[t]&&!o[t].size)throw new Error("eventlisteners.on needs to have detector set with this event type!");o[t].on(u("Map"+t,e)),n[t]=n[t]||new Set,n[t].add(e)}function r(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];o[t].off(e),e?n[t]["delete"](e):delete n[t]}function f(){var t,e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],o=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return t=o?n[e].has(o):!!n[e].size}function v(t,n){e[t]=n}function d(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e[t]}function c(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];o[t]={},o[t]={on:e,off:n}}function l(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];n[t].forEach(function(e){o[t].cbOff(e)}),delete n[t],delete o[t]}function u(t,e){return function(){i.publish(t),e.apply(void 0,arguments)}}return{on:t,off:r,isOn:f,setActivityState:v,getActivityState:d,setDetector:c,clearDetector:l}}var e={},n={},o={},i=window.flatworld.mapEvents;window.flatworld.eventListeners=t()}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _get=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();!function(){function e(e,t){var r,i=t.subcontainersConfig,n=t.subcontainerList,a=Math.floor(e.x/i.width),s=Math.floor(e.y/i.height);return n[a]=n[a]||[],r=n[a][s]=n[a][s]||[],n[a][s].length<=0&&(r=new o({x:a*i.width,y:s*i.height,width:i.width,height:i.height}),n[a][s]=r,r.x=a*i.width,r.y=s*i.height,r.visible=!i.isHiddenByDefault),e.x-=r.x,e.y-=r.y,n[a][s].addChild(e),n[a][s]}function t(e,t){for(var r=e.getSubcontainerConfigs(),i=r.width,n=r.height,a=r.maxDetectionOffset,o={x:t.x>=0?t.x-a:-a,y:t.y>=0?t.y-a:-a,width:(t.width||0)+2*a,height:(t.height||0)+2*a},s=[],l=Math.floor(o.x/i),c=Math.floor(o.y/n),u=o.width?o.x+o.width:+o.x,h=o.height?o.y+o.height:+o.y,f=Math.floor(u/i),y=Math.floor(h/n),d=e.subcontainerList,b=l;f>=b;b++)if(b>=0&&d&&d[b])for(var v=c;y>=v;v++)v>=0&&d[b][v]&&s.push(d[b][v]);return s}var r=window.flatworld_libraries.PIXI,i=[],n=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{name:"",coord:{x:0,y:0},specialLayer:!1,selectable:!1}:arguments[0];_classCallCheck(this,t);var r=e.name,i=e.coord,n=e.specialLayer,a=e.selectable,o=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return Object.assign(o,i),o.name=""+r,o.specialLayer=!!n,o.selectable=a,o.UIObjectList={},o}return _inherits(t,e),_createClass(t,[{key:"hasSubcontainers",value:function(){return!!this.subcontainersConfig}},{key:"isCached",value:function(){return this.cacheAsBitmap}},{key:"move",value:function(e){this.x+=e.x,this.y+=e.y,this.drawThisChild=!0}},{key:"setZoom",value:function(e){return this.scale.x=this.scale.y=+e.toFixed(2),this.scale.x}},{key:"getZoom",value:function(){return this.scale.x}},{key:"getUIObjects",value:function(){return i}},{key:"getPrimaryLayers",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.filters;return this.children.filter(function(e){return!(t&&!t.filter(e).length||e.specialLayer)})}},{key:"getObjects",value:function(){var e=[];return this.hasSubcontainers()&&this.subcontainerList.forEach(function(t){e.concat(t.children)}),e}},{key:"setCache",value:function(e){var t=!!e;return this.cacheAsBitmap=t,t}},{key:"createUILayer",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"default UI layer":arguments[0],r=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],i=new t(e,r);return i.specialLayer=!0,this.addChild(i),this.UILayer=i,i}},{key:"getUILayer",value:function(){return this.UILayer}},{key:"addUIObject",value:function(e,t){var r;return i=i||[],t&&this.UIObjectList[t]&&this.deleteUIObjects(t),this.UIObjectList[t]=e,r=this.getUILayer()?this.getUILayer:this.createUILayer(),this.UILayer.addChild(e),i.push(e),i}},{key:"deleteUIObjects",value:function(e){var t=this,r=this.getUILayer();if(e){var n=this.UIObjectList[e];return r.removeChild(n),void(n=null)}return Object.keys(this.UIObjectList).map(function(e){var i=t.UIObjectList[e];r.removeChild(i),i=null}),i}}]),t}(r.Container),a=function(r){function i(){var e=arguments.length<=0||void 0===arguments[0]?{name:"",coord:{x:0,y:0},subcontainers:!1,specialLayer:!1,selectable:!1}:arguments[0];_classCallCheck(this,i);var t=e.subcontainers,r=e.selectable,n=e.specialLayer,a=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,e));return a.oldAddChild=_get(Object.getPrototypeOf(i.prototype),"addChild",a).bind(a),a.subcontainersConfig=t,a.subcontainerList=[],a.selectable=r,a.specialLayer=n,a}return _inherits(i,r),_createClass(i,[{key:"addChild",value:function(t){if(this.hasSubcontainers()){var r=void 0;r=e(t,this),this.oldAddChild(r)}else this.oldAddChild(t);return t}},{key:"getSubcontainerConfigs",value:function(){return this.subcontainersConfig}},{key:"getSubcontainersByCoordinates",value:function(e){if(!this.hasSubcontainers())throw new Error("tried to retrieve subcontainers, when they are not present");var r;return r=t(this,e)}},{key:"getSubcontainers",value:function(){return this.subcontainerList}}]),i}(n),o=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return r.specialLayer=!0,r.size=e,r.selectable=!1,r}return _inherits(t,e),_createClass(t,[{key:"getSubcontainerArea",value:function(){var e,t=arguments.length<=0||void 0===arguments[0]?{toGlobal:!0}:arguments[0];return e=t.toGlobal?this.toGlobal(new r.Point(0,0)):this,{x:Math.round(e.x),y:Math.round(e.y),width:Math.round(this.size.width),height:Math.round(this.size.height)}}},{key:"setCache",value:function(e){var t=!!e;return this.cacheAsBitmap=t,t}}]),t}(r.Container);window.flatworld.mapLayers=window.flatworld.mapLayers||{},window.flatworld.mapLayers.MapLayer=n,window.flatworld.mapLayers.MapLayerParent=a}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(){var e=window.flatworld.mapLayers,t=window.flatworld.objects,r=function(){function r(n){_classCallCheck(this,r),this.rules=Array.isArray(n)?n:[n],this.classes={layer:Object.keys(e).map(function(t){return e[t]}),object:Object.keys(t).map(function(e){return t[e]})}}return _createClass(r,[{key:"filter",value:function(e){var t,r=this;return t=Array.isArray(e)?e.filter(function(e){return r._runRule(e)}):this._runRule(e)?[e]:[]}},{key:"addRule",value:function(e){this.rules.concat(e)}},{key:"_runRule",value:function(e){var t,r,n=this;return Object.keys(this.classes).forEach(function(t){var a=n.classes[t].filter(function(t){return e instanceof t});r=a.length?t:r}),this.rules.forEach(function(a){if("filter"===a.type){if(a.object!==r)return;"layer"===r?t=n._getObject(e,a):"object"===r&&(t=n._getObject(e,a))}}),t}},{key:"_getObject",value:function(e,t){return e[t.property]===t.value}}]),r}();window.flatworld.MapDataManipulator=r}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(){function e(e,n){var r;if(t)return t;if(!e||!n)throw new Error("UI-module requires UITheme and map object");return r=n,t={},t.showSelections=function(t,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=r.filters,l=r.UIThemeOptions;return i&&(t=i.filterObjects(t)),t=Array.isArray(t)?t:[t],1===t.length?e.highlightSelectedObject(t[0],n,l):t.length>1?e.showSelections(t,n,l):(o.error("No objects found"+t.length),[])},t.showUnitMovement=function(t,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=r.filters,l=r.UIThemeOptions;return i&&(t=i.filterObjects(t)),(Array.isArray(t)||"object"!==("undefined"==typeof t?"undefined":_typeof(t))||null===t)&&o.error("Object was an Array, should be plain object: "+t.length),e.showUnitMovement(t,n,l)},t.extend=function(o){t[o]=function(){e[o]()}},t}var t,o=window.flatworld.log;window.flatworld.UI=e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"retrieve",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{type:!1,subcontainers:[],size:{width:0,height:0}}:arguments[1],n=t.subcontainers,r=t.size,a=t.type,i=e.globalCoords,c=[];return n.length>0&&(n.forEach(function(e){c=c.concat(e.children)}),r.width&&r.height||(c=c.filter(function(e){if(a&&a!==e.type)return!1;var t=e.hitTest?e.hitTest(i):!0;return t}))),c}}]),e}();window.flatworld.ObjectManager=e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}();!function(){var t=window.flatworld.utils,e=window.flatworld_libraries.PIXI,n=window.flatworld.mapAPI,o=window.flatworld.mapEvents,i=function(t){function n(t){var e=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=o.data,r=void 0===i?null:i;_classCallCheck(this,n);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,t)),l={x:Math.round(e.x),y:Math.round(e.y)};return a.position.set(l.x,l.y),a.name="Objects_sprite_"+a.id,a.type="None",a.highlightable=!0,a.data=r,a.areaWidth=a.width,a.areaHeight=a.height,a}return _inherits(n,t),_createClass(n,[{key:"innerDraw",value:function(t,e){return this.fromFrame(this.currentFrame),this.x=t,this.y=e,this}},{key:"drawNewFrame",value:function(t,e,n){return this.currentFrame=n,this.innerDraw(t,e)}},{key:"getGraphicalArea",value:function(){var t,n=arguments.length<=0||void 0===arguments[0]?{toGlobal:!0}:arguments[0];return t=n.toGlobal?this.toGlobal(new e.Point(0,0)):this,{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(this.width),height:Math.round(this.height)}}},{key:"localToLocal",value:function(t,e,n){var o=this.toGlobal({x:t,y:e}),i=n.toLocal(o);return i}},{key:"clone",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?{position:!1,anchor:!1}:arguments[1],o=new e.Sprite;return o.texture=this.generateTexture(t),n.anchor&&(o.anchor=Object.assign({},this.anchor)),n.position&&(o.position=Object.assign({},this.position)),o}}]),n}(e.Sprite),r=function(t){function e(t,n){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=o.data,r=void 0===i?null:i;_classCallCheck(this,e);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,n,{data:r}));return a.name="DefaultTerrainObject",a.type="terrain",a.highlightable=!1,a}return _inherits(e,t),e}(i),a=function(e){function i(t,e){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=n.data,r=void 0===o?null:o;_classCallCheck(this,i);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,t,e,{data:r}));return a.name="DefaultUnitObjects",a.type="unit",a.actions={},a}return _inherits(i,e),_createClass(i,[{key:"doAction",value:function(t){this.actions[t].forEach(function(t){t()})}},{key:"addActionType",value:function(t){this.actions[t]=this.actions[t]||[]}},{key:"addCallbackToAction",value:function(t,e){this.actions[t].push(e)}},{key:"dropShadow",value:function(){var e;return(e=t.effects).dropShadow.apply(e,arguments)}},{key:"move",value:function(t){o.publish("objectMove",this),n.post("objectMove",{id:this.id,from:{x:this.x,y:this.y},to:t})}}]),i}(i);window.flatworld.objects.ObjectSprite=i,window.flatworld.objects.ObjectSpriteTerrain=r,window.flatworld.objects.ObjectSpriteUnit=a}();
"use strict";function _classCallCheck(e,l){if(!(e instanceof l))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,l){for(var n=0;n<l.length;n++){var o=l[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(l,n,o){return n&&e(l.prototype,n),o&&e(l,o),l}}();!function(){var e=window.flatworld_libraries.Q,l=window.flatworld_libraries.Howler,n=(window.flatworld.mapLayers,function(){function n(){_classCallCheck(this,n),this._allSounds={}}return _createClass(n,[{key:"add",value:function(e,n){var o=arguments.length<=2||void 0===arguments[2]?{loop:!1,volume:1}:arguments[2],a=o.loop,t=o.volume;return this._allSounds[e]={},this._allSounds[e]=new l({urls:[n],autoplay:!1,loop:a,volume:t}),this._allSounds[e]}},{key:"remove",value:function(e){delete this._allSounds[e]}},{key:"play",value:function(l){var n=e.defer();this._allSounds[l]._onend=function(){n.resolve(!0)},this._allSounds[l].play()}},{key:"stop",value:function(e){this._allSounds[e].stop()}},{key:"fade",value:function(l,n,o,a){var t,r=e.defer();return t=function(){r.resolve(!0)},this._allSounds[l].fade(n,o,a,t),r.promise}}]),n}());window.flatworld.Sound=n}();
"use strict";!function(){function e(){return t.create({initial:"statusQuo",events:[{name:"objectSelect",from:["statusQuo","objectSelected"],to:"objectSelected"},{name:"objectOrder",from:"objectSelected",to:"animatingObject"},{name:"objectOrderEnd",from:"animatingObject",to:"objectSelected"},{name:"UIOpen",from:["statusQuo","objectSelected"],to:"mainUIOpened"},{name:"UIClose",from:"mainUIOpen",to:"statusQuo"},{name:"mapMove",from:["statusQuo","objectSelected"],to:"mapMoving"},{name:"mapMoveEnd",from:["mapMoving"],to:"statusQuo"}]})}var t=window.StateMachine;window.flatworld.mapStates=e()}();
"use strict";!function(){function e(){function e(e){var t=d(),o=u();S=e,p=new i.Manager(e.canvas),m=new f(e.canvas),n.setDetector("fullSize",a().on,a().off),n.setDetector("fullscreen",l().on,l().off),n.setDetector("zoom",s().on,s().off),n.setDetector("drag",c().on,c().off),n.setDetector("select",o.on,o.off),n.setDetector("order",t.on,t.off),n.on("fullSize",g),e.setPrototype("setFullScreen",function(){n.on("fullscreen",v)})}function a(){var e;return{on:function(n){e=n,window.addEventListener("resize",e)},off:function(){window.removeEventListener("resize",e)}}}function l(){var e;return{on:function(n){e=n,window.addEventListener("fullscreen",e)},off:function(){window.removeEventListener("fullscreen",e)}}}function s(){var e;return{on:function(n){var t=new i.Pinch;e=n,p.add(t),p.on("pinch",e),m.wheel(e)},off:function(){p.on("pinch",e),m.unwheel(e)}}}function c(){var e;return{on:function(n){var t=new i.Pan({pointers:1,threshold:5,direction:i.DIRECTION_ALL});e=n,p.add(t),p.on("pan",e)},off:function(){p.off("pan",e)}}}function u(){var e;return{on:function(n){var t=new i.Tap;e=n,p.add(t),p.on("tap",e)},off:function(){p.off("tap",e)}}}function d(){function e(e){return e.preventDefault(),t.can("objectOrder")||!S.isSupportedTouch&&!r.mouse.isRightClick(e)?void n(e):!1}var n;return{on:function(t){if(n=t,S.isSupportedTouch){var o=new i.Tap;p.add(o),p.on("tap",e)}else S.canvas.addEventListener("contextmenu",e,!0)},off:function(){p.off("tap",e),S.canvas.removeEventListener("contextmenu",e,!0)}}}function w(){var e=document.getElementsByTagName("body")[0].style;e.webkitTouchCallout="none",e.webkitUserSelect="none",e.khtmlUserSelect="none",e.mozUserSelect="none",e.msUserSelect="none",e.userSelect="none"}function v(){r.resize.toggleFullScreen(),o.publish("mapResized"),g()}function g(){var e=r.resize.getWindowSize(),n=S.getRenderer();n.autoResize=!0,n.resize(e.x,e.y),o.publish("mapResized"),S.drawOnNextTick()}var p,m,S;return{init:e,toggleFullSize:a,toggleFullscreen:l,toggleZoom:s,toggleDrag:c,toggleSelect:u,toggleOrder:d,toggleMouseTextSelection:w,pluginName:"baseEventlisteners"}}var n=window.flatworld.eventListeners,t=window.flatworld.mapStates,o=window.flatworld.mapEvents,r=window.flatworld.utils,i=window.flatworld_libraries.Hammer,f=window.flatworld_libraries.Hamster;window.flatworld.extensions.baseEventlisteners=e()}();
"use strict";!function(){function t(){function t(t){a=r(t),n.on("drag",a)}function r(t){var r=!1;return function(i){var a;return n.getActivityState("zoom")?!1:(a=e.mouse.eventData.getHAMMERPointerCoords(i),u=!0,a.x=Math.round(a.x),a.y=Math.round(a.y),r?(i.isFinal===!0&&(r=!1,u=!1),void o(i,t,a)):(f.setOffset({x:a.x,y:a.y}),void(r=!0)))}}function o(t,n,e){var r,o;r=f.getOffset(),o={x:e.x-r.x,y:e.y-r.y},o.x>0||o.y>0||o.x<0||o.y<0?n.moveMap(o):u=!1,f.setOffset({x:e.x,y:e.y}),t.preventDefault()}function i(){function t(t){return e=t}function n(){return e}var e;return{setOffset:t,getOffset:n}}var a,f=i(),u=!1;return{init:t,pluginName:"mapDrag",_startDragListener:r}}var n=window.flatworld.eventListeners,e=window.flatworld.utils;window.flatworld.extensions.mapDrag=t()}();
"use strict";!function(){function o(){function o(o){v=o,v.setPrototype("zoomIn",i),v.setPrototype("zoomOut",a),v.setPrototype("setZoomLimits",r),v.setPrototype("setZoomModifier",n),t.on("zoom",s)}function n(o){if(!(o>0||.5>=o))throw new Error("Wrong zoom modifier! (needs to be >0 and <=0.5, given:"+o);return d=o,this}function r(o,t){return w.farther=o,w.closer=t,this}function i(o){var t=this.getZoom(),e=!0;return p(this,t,Math.abs(o)||d,e)}function a(o){var t=this.getZoom(),e=!1;return o=0>o?o:-o,p(this,t,o||-d,e)}function s(o,t,e,r){t?m(o,t,e,r):o.pointers&&(l||(l=!0,n(.5*d)),u(o))}function m(o,t,e,n){var r=n,i=v.getZoom();o.preventDefault(),r>0?v.zoomIn()&&v.moveMap(c(i,!0),c(v.getZoom(),!0)):0>r&&v.zoomOut()&&v.moveMap(c(i),c(v.getZoom()))}function u(o){var e=o.pointers,n=[{x:e[0].pageX,y:e[0].pageY},{x:e[1].pageX,y:e[1].pageY}],r=Math.abs(n[0].x-n[1].x),i=Math.abs(n[0].y-n[1].y);o.preventDefault();try{if(!g)return h={x:r,y:i},t.setActivityState("zoom",!0),void(g=!0);4!==o.eventType&&8!==o.eventType||(window.setTimeout(function(){t.setActivityState("zoom",!1)},y),g=!1),h.x+h.y<r+i?v.zoomIn()&&v.moveMap(c(v.getZoom(),!0)):v.zoomOut()&&v.moveMap(c(v.getZoom())),h={x:r,y:i}}catch(a){console.log("Error! ",a)}}function f(o,t){return!!(t&&o>w.closer||!t&&o<w.farther)}function c(o,t){var n=e.resize.getWindowSize(),r={x:n.x/2/o,y:n.y/2/o},i={x:r.x*(t?-d:d),y:r.y*(t?-d:d)};return i}function p(o,t,e,n){var r;return f(t,n)||(r=o.setZoom(e?t+e:t+d)),r}var v,y=40,g=!1,l=!1,h={},w={farther:.4,closer:2.5},d=.1;return{init:o,pluginName:"mapZoom"}}var t=window.flatworld.eventListeners,e=window.flatworld.utils;window.flatworld.extensions.mapZoom=o()}();
"use strict";window.flatworld.extensions.hexagons={},window.flatworld.extensions.hexagons.utils={},window.flatworld.extensions.hexagons.eventlisteners={};
"use strict";!function(){function o(o){var n=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],t=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=t.orientation,i=void 0===r?"horizontal":r;h=o,u=n,x=i}function n(){var o=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=o.radius,t=void 0===n?h:n,r=o.orientation,i=void 0===r?"horizontal":r;t||d.error("You need to define at least globalRadius for the hexagonMath utils class");var a="horizontal"===i?.5:0,e={x:t,y:t},l=2*Math.PI/6*a,s=e.x*Math.cos(l),u=e.y*Math.sin(l),x=[];x.push({x:s,y:u});for(var f=1;7>f;f++)l=2*Math.PI/6*(f+a),s=e.x*Math.cos(l),u=e.y*Math.sin(l),x.push({x:s,y:u});return x}function t(){var o,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=n.radius,r=void 0===t?h:t,i=n.floorNumbers,a=void 0===i?!0:i;return o=r*Math.sqrt(3),o=a?Math.floor(o):o}function r(){var o,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=n.radius,r=void 0===t?h:t,i=n.floorNumbers,a=void 0===i?!0:i;return o=2*r,o=a?Math.floor(o):o}function i(){var o=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=o.radius,t=void 0===n?h:n;return r(t)-t/2}function a(o,n){var t,r=arguments.length<=2||void 0===arguments[2]?{x:0,y:0}:arguments[2];return t=o.map(function(o){return{x:o.x+r.x,y:o.y+r.y}}),s(n,t)}function e(o){var n,i,a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],e=a.radius,l=void 0===e?h:e,s=a.orientation,d=void 0===s?"horizontal":s,u=o.rows,x=o.columns,f=[],v=t(l),g=r(l)-l/2;n="horizontal"===d?g:v,i="horizontal"===d?v:g;for(var w=0;u>w;w++)for(var y=0;x>y;y++)f.push({x:Math.round(y*i+("horizontal"!==d||0!==w&&w%2!==0?-v/2:0)),y:w*n});return f}function l(o){var n,a=h;if(!x||!a||!u)throw new Error("getClosestHexagonCenter requirements not filled");return n="horizontal"===x?{x:Math.round(o.x-o.x%t(a)+t(a)/2+u.x),y:Math.round(o.y-o.y%i(a)+r(a)/2+u.y)}:{x:Math.floor(o.x-o.x%i(a)+u.x),y:Math.floor(o.y-o.y%t(a)+u.y)}}function s(o,n){for(var t,r,i,a,e,l=o.x,s=o.y,d=!1,h=0,u=n.length-1;h<n.length;u=h++)t=n[h].x,i=n[h].y,r=n[u].x,a=n[u].y,e=i>s!=a>s&&(r-t)*(s-i)/(a-i)+t>l,e&&(d=!d);return d}var d=window.flatworld.log;window.flatworld.extensions.hexagons.utils.init=o,window.flatworld.extensions.hexagons.utils.createHexagonGridCoordinates=e,window.flatworld.extensions.hexagons.utils.getHexagonPoints=n,window.flatworld.extensions.hexagons.utils.calcShortDiagonal=t,window.flatworld.extensions.hexagons.utils.calcLongDiagonal=r,window.flatworld.extensions.hexagons.utils.hexaHitTest=a,window.flatworld.extensions.hexagons.utils.getClosestHexagonCenter=l;var h,u,x}();
"use strict";!function(){function n(n){var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],e=o.orientation,r=void 0===e?"horizontal":e,l=[];if("horizontal"!==r)throw new Error("Nothing else than horizontal supported so far!");return l=t(n),new i.Polygon(l)}function o(n){var o=arguments.length<=1||void 0===arguments[1]?{color:"#000000",isFlatTop:!1}:arguments[1],e=new i.Graphics,r=t(n);return e.beginFill(o.color,1),e.drawPolygon(r),e.endFill(),e}function t(n){return e(n).map(function(n){return new i.Point(n.x,n.y)})}var i=window.flatworld_libraries.PIXI,e=window.flatworld.extensions.hexagons.utils.getHexagonPoints;window.flatworld.extensions.hexagons.utils.createHexagon=n,window.flatworld.extensions.hexagons.utils.createVisibleHexagon=o}();
"use strict";!function(){function e(e){function s(o){var a,i=t.mouse.eventData.getHAMMERPointerCoords(o),s={allData:function(e){return e.data.typeData}},c=new n({type:"filter",object:"layer",property:"name",value:"unitLayer"});l.objectSelect(),a=e.getObjectsUnderArea(i,{filters:c}),a=t.dataManipulation.mapObjectsToArray(a),a=t.dataManipulation.flattenArrayBy1Level(a),a.length&&r.publish("objectsSelected",a),e.currentlySelectedObjects=a,d.showSelections(a,s),e.drawOnNextTick()}function c(o){var a,s=(new n({type:"filter",object:"layer",property:"name",value:"unitLayer"}),e.currentlySelectedObjects[0]);e.currentlySelectedObjects.length>1?i.error("the selected object is only supported to be one atm."+JSON.stringify(e.currentlySelectedObjects)):s||i.error("No objects selected for orders! "+JSON.stringify(s)),l.objectOrder(),a=e.isSupportedTouch?t.mouse.eventData.getHAMMERPointerCoords(o):t.mouse.eventData.getPointerCoords(o),s.move(a),r.publish("objectMoves",s),d.showUnitMovement(s,a),l.objectOrderEnd(),e.drawOnNextTick()}var d;if(!e)throw new Error("eventlisteners initialization requires flatworld instance as a parameter");return d=o(),a.on("select",s),a.on("order",c),!0}var t=window.flatworld.utils,r=window.flatworld.mapEvents,o=window.flatworld.UI,n=window.flatworld.MapDataManipulator,a=window.flatworld.eventListeners,l=window.flatworld.mapStates,i=window.flatworld.log;window.flatworld.extensions.hexagons.setupHexagonClick=e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(){function t(t){if(!t)throw new Error("Need radius!");var n=Math.round(s(t)),r=Math.round(c(t)),o=Math.round(t);this.anchor.set(.5,.5),this.areaHeight=this.HEIGHT=n,this.areaWidth=this.WIDTH=r,this.SIDE=o,this.ROW_HEIGHT=Math.round(.75*n),this.hitArea=e(t),this.hitTest=function(t){var e;return e=this.toLocal(new h.Point(t.x,t.y)),this.hitArea.contains(e.x,e.y)}}function e(t){return n||(n=l(t)),n}var n,r=window.flatworld.objects,o=r.ObjectSpriteTerrain,i=r.ObjectSpriteUnit,a=window.flatworld.extensions.hexagons.utils,s=a.calcLongDiagonal,c=a.calcShortDiagonal,l=a.createHexagon,h=window.flatworld_libraries.PIXI,u=function(e){function n(e){var r=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=o.data,a=o.radius;_classCallCheck(this,n);var s=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,r,{data:i}));return s.name="DefaultTerrainObject_hexa",t.call(s,a),s}return _inherits(n,e),n}(o),f=function(e){function n(e){var r=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=o.data,a=void 0===i?null:i,s=o.radius,c=void 0===s?null:s;_classCallCheck(this,n);var l=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,r,{data:a}));return l.name="DefaultUnitObjects_hexa",t.call(l,c),l}return _inherits(n,e),n}(i);window.flatworld.extensions.hexagons.objects={ObjectHexaTerrain:u,ObjectHexaUnit:f}}();
"use strict";!function(){function n(){function n(n){o=n,t(o)}function t(n){return e(n)}var o={};return{init:n,pluginName:"selectHexagonObject"}}var e=window.flatworld.extensions.hexagons.setupHexagonClick;window.flatworld.extensions.hexagons.selectHexagonObject=n()}();
"use strict";!function(){function t(){function t(t){d=t,w=d.getZoom(),i(),o(),d.drawOnNextTick(),b&&(window.FlaTWorld_mapMovement_subCheck=function(){d.getPrimaryLayers().forEach(function(t){var e,i,r=n.flatten2Levels(t.getSubcontainers());e=r.filter(function(t){return t.visible}),i=r.filter(function(t){return!t.visible});var o=e.reduce(function(t,e){t+e.x+""});window.flatworld.log.debug("visible subcontainers: "+e.length+", "+o+"\n\ninvisible: "+i.length)})},window.FlaTWorld_mapMovement_deactivate=function(){d.getPrimaryLayers().forEach(function(t){var e,i=n.flatten2Levels(t.getSubcontainers());e=i.forEach(function(t){t.visible=!1})})})}function i(){var t;t=d.getViewportArea(!0),d.getPrimaryLayers().forEach(function(e){var i=n.flatten2Levels(e.getSubcontainers());i.forEach(function(e){e.visible=!a(e,t)})})}function r(){function t(){var t;t=d.getViewportArea(!0),c(t,d.getPrimaryLayers())}if(g.processing)return!1;g.processing=!0;var e=t();window.setTimeout(e,v)}function o(){function t(t){var e=t.customData[0];m.width+=e.x,m.height+=e.y,r()}function n(){r()}function i(t){w=t.customData[0].newScale,r()}e.subscribe("mapMoved",t),e.subscribe("mapResized",n),e.subscribe("mapZoomed",i)}function a(t,e){var n,i;return i=t.getSubcontainerArea({toGlobal:!1}),n=!s(i,e)}function c(t,e){var i,r,o=[];r=u(t),m.width=0,m.height=0,e=n.chunkArray(e,2),i=e.map(function(t){var e=window.Q.defer();return window.setTimeout(function(){var n;n=t.map(function(t){return t.getSubcontainersByCoordinates(r)}),o=o.concat(n),e.resolve(!0)}),e.promise}),i=window.Q.all(i).then(function(){var e,i;return o=n.flatten2Levels(o),e=n.chunkArray(o,40),i=e.map(function(e){var n=window.Q.defer();return window.setTimeout(function(){e.forEach(function(e){e.visible=!a(e,t)}),n.resolve(!0)}),n.promise})}),window.Q.all(i).then(function(){g.processing=!1,d.drawOnNextTick()}).then(null,function(t){window.flatworld.log.debug(t)})}function u(t){var e=arguments.length<=1||void 0===arguments[1]?{scale:1}:arguments[1],n=l(t,e);return{x:Math.round(t.x-n),y:Math.round(t.y-n),width:Math.round(t.width+2*n),height:Math.round(t.height+2*n)}}function s(t,e){return t.x<=e.x+e.width&&e.x<=t.x+t.width&&t.y<=e.y+e.height&&e.y<=t.y+t.height}function l(t){var e=arguments.length<=1||void 0===arguments[1]?{scale:1}:arguments[1];return Math.abs(t.width/e.scale*h)}function f(t){d=t}var d,w,h=.2,v=20,g={},m={width:0,height:0},b=!1;return{init:t,pluginName:"mapMovement",addAll:i,check:r,startEventListeners:o,_testObject:{isObjectOutsideViewport:a,viewportWorkerOnMessage:c,getViewportWithOffset:u,testRectangleIntersect:s,_setMap:f}}}var e=window.flatworld.mapEvents,n=window.flatworld.generalUtils.arrays;window.flatworld_libraries.Q;window.flatworld.extensions.mapMovement=t()}();
"use strict";window.flatworld.UIs=window.flatworld.UIs||{},window.flatworld.UIs["default"]={},window.flatworld.UIs["default"].utils={},window.flatworld.UIs["default"].layout={};
"use strict";!function(){window.flatworld.UIs["default"].utils.drawShapes=function(){function t(t,e,a,n,o,i,r,s,h){function M(t,e,a,n,o,i,r,s){var h;switch(e=+e,a=+a,n=+n,o=+o,i=+i,r=+r,t.beginStroke("#F00").moveTo(e,a).lineTo(n,o).lineTo(i,r),s){case 0:h=Math.sqrt((i-e)*(i-e)+(r-a)*(r-a)),t.arcTo(n,o,e,a,.55*h),t.fill();break;case 1:t.beginStroke("#F00").moveTo(e,a).lineTo(n,o).lineTo(i,r).lineTo(e,a).fill();break;case 2:break;case 3:var M=(e+n+i)/3,f=(a+o+r)/3;t.beginFill().quadraticCurveTo(M,f,e,a);break;case 4:var c,l,d,u,p=5;if(i===e)h=r-a,c=(n+e)/2,d=(n+e)/2,l=o+h/p,u=o-h/p;else{h=Math.sqrt((i-e)*(i-e)+(r-a)*(r-a));var y=(e+i)/2,v=(a+r)/2,T=(y+n)/2,b=(v+o)/2,g=(r-a)/(i-e),k=h/(2*Math.sqrt(g*g+1))/p,I=g*k;c=T-k,l=b-I,d=T+k,u=b+I}t.bezierCurveTo(c,l,d,u,e,a),t.fill()}}var f,c,l,d,u,p,y=t.graphics,v="#000";"string"==typeof e&&(e=parseInt(e,10)),"string"==typeof a&&(a=parseInt(a,10)),"string"==typeof n&&(n=parseInt(n,10)),"string"==typeof o&&(o=parseInt(o,10)),i="undefined"!=typeof i?i:3,r="undefined"!=typeof r?r:1,s="undefined"!=typeof s?s:Math.PI/8,h="undefined"!=typeof h?h:10;var T,b,g,k,I="function"!=typeof i?M:i,S=Math.sqrt((n-e)*(n-e)+(o-a)*(o-a)),m=(S-h/3)/S;1&r?(T=Math.round(e+(n-e)*m),b=Math.round(a+(o-a)*m)):(T=n,b=o),2&r?(g=e+(n-e)*(1-m),k=a+(o-a)*(1-m)):(g=e,k=a),y.beginStroke(v).moveTo(g,k).lineTo(T,b);var q=Math.atan2(o-a,n-e),w=Math.abs(h/Math.cos(s));return 1&r&&(f=q+Math.PI+s,c=n+Math.cos(f)*w,l=o+Math.sin(f)*w,d=q+Math.PI-s,u=n+Math.cos(d)*w,p=o+Math.sin(d)*w,I(y,c,l,n,o,u,p,i)),2&r&&(f=q+s,c=e+Math.cos(f)*w,l=a+Math.sin(f)*w,d=q-s,u=e+Math.cos(d)*w,p=a+Math.sin(d)*w,I(y,c,l,e,a,u,p,i)),!0}function e(e,a,n,o,i,r,s,h,M,f,c){var l,d,u,p,y;h="undefined"!=typeof h?h:3,M="undefined"!=typeof M?M:1,f="undefined"!=typeof f?f:Math.PI/8,c="undefined"!=typeof c?c:10,e.beginPath(),e.arc(a,n,o,i,r,s),e.stroke(),e.strokeStyle="rgba(0,0,0,0)",1&M&&(l=Math.cos(i)*o+a,d=Math.sin(i)*o+n,u=Math.atan2(a-l,d-n),s?(p=l+10*Math.cos(u),y=d+10*Math.sin(u)):(p=l-10*Math.cos(u),y=d-10*Math.sin(u)),t(e,l,d,p,y,h,2,f,c)),2&M&&(l=Math.cos(r)*o+a,d=Math.sin(r)*o+n,u=Math.atan2(a-l,d-n),s?(p=l-10*Math.cos(u),y=d-10*Math.sin(u)):(p=l+10*Math.cos(u),y=d+10*Math.sin(u)),t(e,l,d,p,y,h,2,f,c))}function a(t,e,a){var n=arguments.length<=3||void 0===arguments[3]?{color:"#000000",style:5}:arguments[3],o=n.color,i=n.style;return t.lineStyle(i,o),t.moveTo(e.x,e.y),t.lineTo(a.x,a.y),t.endFill(),t}return{normal:t,arced:e,line:a}}()}();
"use strict";!function(){var l=window.flatworld_libraries.Handlebars;window.flatworld.UIs=window.flatworld.UIs||{},window.flatworld.UIs["default"]=window.flatworld.UIs["default"]||{},window.flatworld.UIs["default"].templates={multiSelection:l.compile("\n      <span style='font-size:200%;display:block;margin-bottom:20px;'>\n        {{title}}\n      </span>\n      <ul>\n        {{#each objects}}\n        <li>\n          {{this.data.typeData.name}}\n        </li>\n        {{/each}}\n      </ul>"),singleSelection:l.compile("\n      <span style='font-size:200%;display:block;margin-bottom:20px;'>\n        {{title}}\n      </span>\n      <ul>\n        <li>\n          {{object.name}}\n        </li>\n      </ul>")}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,a,l){return a&&e(t.prototype,a),l&&e(t,l),t}}();!function(){function e(e){if(!r[e]){var t=document.querySelector(i[e]);r[e]=t}return r[e]}var t,a=window.flatworld_libraries.PIXI,l=window.flatworld.UIs["default"].templates,o=window.flatworld.extensions.hexagons.utils.createVisibleHexagon,n=window.flatworld.UIs["default"].utils.drawShapes,i={select:"#dialog_select"},r={},s=function(){function r(e,a){var l=arguments.length<=2||void 0===arguments[2]?{styles:"#F0F0F0"}:arguments[2];_classCallCheck(this,r),t=this.addStyleElement();var o="\n        "+i.select+" {\n          z-index: 9999;\n          opacity: 0.9;\n          position: fixed;\n          left: 0px;\n          bottom: 0px;\n          background-color: brown;\n          border: 1px solid rgb(255, 186, 148);;\n          border-bottom: 0px;\n          padding:15px;\n          margin-left:10px;\n        }";this.addCSSRulesToScriptTag(t,o),this.map=a,this.modal=e||document.getElementById("dialog_select"),this.styles=l.styles}return _createClass(r,[{key:"getTemplates",value:function(){return l}},{key:"showSelections",value:function(t,a,o){var n,r=this,s=this.map.drawOnNextTick.bind(this.map),c=this.map.getMovableLayer();n=t&&t.length>1?function(){r.modal.innerHTML=l.multiSelection({title:"Objects",objects:t}),r.showModal(r.modal,i),e("select").style.display="block"}:1===t.length?function(){r.highlightSelectedObject(t[0])}:function(){c.deleteUIObjects(),s(),console.log("Error occured selecting the objects on this coordinates! Nothing found")},e("select").style.display="none",n()}},{key:"highlightSelectedObject",value:function(t,a){var o,n,r=arguments.length<=2||void 0===arguments[2]?{shadow:{color:"0x0000",distance:5,alpha:.55,angle:45,blur:5}}:arguments[2],s=r.shadow;return n=a.allData(t),this.modal.innerHTML=l.singleSelection({title:"Selected",object:{name:n.name}}),this.showModal(this.modal,i),o=this._highlightSelectedObject(t,this.map.getRenderer()),o.dropShadow({color:s.color,distance:s.distance,alpha:s.alpha,angle:s.angle,blur:s.blur}),this.map.drawOnNextTick(),e("select").style.display="block",o}},{key:"showUnitMovement",value:function(e,t){var l,o,i,r="movementArrow";l=this.map.getMovableLayer().toLocal(t),o=this.map.getMovableLayer().toLocal(e.toGlobal(new a.Point(0,0))),i=n.line(new a.Graphics,o,l),this.map.removeUIObject(this.map.layerTypes.movableType.id,r),this.map.addUIObject(this.map.layerTypes.movableType.id,i,r),this.map.drawOnNextTick()}},{key:"init",value:function(){}},{key:"_highlightSelectedObject",value:function(e,t){var l,o=this.map.getMovableLayer();l=e.clone(t),l.__proto__=e.__proto__;var n=e.toGlobal(new a.Point(0,0));return n=o.toLocal(n),n.x-=e.width*e.anchor.x,n.y-=e.height*e.anchor.y,this.createHighlight(l,{coords:n}),l}},{key:"createHighlight",value:function(e){var t,l=arguments.length<=1||void 0===arguments[1]?{coords:new a.Point(0,0)}:arguments[1],n=47,i="unit highlight",r=this.map.getMovableLayer(),s=new this.map.createSpecialLayer("UILayer",{toLayer:r}),c={x:Number(e.x),y:Number(e.y)};t=o(n,{color:"#F0F0F0"}),t.x=c.x+32,t.y=c.y+27,t.alpha=.5,s.addChild(t),s.addChild(e),s.position=l.coords,this.map.removeUIObject(this.map.layerTypes.movableType.id),this.map.addUIObject(this.map.layerTypes.movableType.id,s,i)}},{key:"addCSSRulesToScriptTag",value:function(e,t){e.insertRule(t,0)}},{key:"addStyleElement",value:function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}},{key:"showModal",value:function(e,t){e.classList.add(t.select)}}]),r}();window.flatworld.UIs["default"].init=s}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(){function e(e,t){t?n.children.forEach(function(t){if(!t.isCached())return!1;var n=t.getSubcontainers();n.forEach(function(t){t.setCache(e)})}):n.children.forEach(function(t){return t.isCached()?void t.setCache(e):!1})}var t,n,i,a,r=window.flatworld_libraries,o=r.Q,s=r.PIXI,u=window.flatworld,c=u.mapLayers,l=u.ObjectManager,h=u.mapEvents,y=u.generalUtils,d=u.log,g=0,v=1,f="0.0.1",b=!1,p=[],m=function(){function r(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],o=arguments.length<=1||void 0===arguments[1]?{bounds:{width:0,height:0},rendererOptions:{refreshEventListeners:!0},subcontainers:!1,cache:!1,trackFPSCB:!1}:arguments[1];_classCallCheck(this,r);var u=o.bounds,h=o.rendererOptions,d=o.subcontainers,b=o.trackFPSCB,p=o.cache;if(!e)throw new Error(this.constructor.name+" needs canvasContainer!");"string"==typeof e&&(e=document.querySelector(e)),i=s.autoDetectRenderer(u.width,u.height,h),i.plugins.interaction.destroy(),e.innerHTML="",e.appendChild(i.view,e),a=d?c.MapLayerParent:c.MapLayer,t=new c.MapLayer({name:"staticLayer",coord:{x:0,y:0}}),n=new c.MapLayer({name:"movableLayer",coord:{x:0,y:0}}),t.addChild(n),i.view.style.position="absolute",i.view.style.display="block",i.view.style.left="0px",i.view.style.top="0px",document.getElementsByTagName("body")[0].style.overflow="hidden",i.roundPixels=!0,this.canvas=i.view,this.plugins=new Set,this.subcontainersConfig=d,this.trackFPSCB=b,this.objectManager=new l,this.cache=p,this.isSupportedTouch=y.environmentDetection.isTouchDevice(),this.currentlySelectedObjects=[],this.layerTypes={staticType:{id:g,layer:t},movableType:{id:v,layer:n}},this.VERSION=f}return _createClass(r,[{key:"init",value:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],i=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=arguments.length<=3||void 0===arguments[3]?{fullsize:!0}:arguments[3],r=[];return a.fullsize&&this.toggleFullsize(),e.length&&(r=this.activatePlugins(e)),t&&Object.assign(n,t),this._defaultTick(),i&&this.customTickOn(i),p=r,this.cache&&this.cacheMap(),this.drawOnNextTick(),r||Promise.resolve()}},{key:"whenReady",value:function(){return o.all(p)}},{key:"drawOnNextTick",value:function(){b=!0}},{key:"addUIObject",value:function(e,t,n){var i=this;Array.isArray(t)?t.forEach(function(t){i._addObjectToUIlayer(e,t)}):this._addObjectToUIlayer(e,t,n)}},{key:"removeUIObject",value:function(e,t){switch(e){case g:this.getStaticLayer().deleteUIObjects(t);break;case v:this.getMovableLayer().deleteUIObjects(t)}}},{key:"createSpecialLayer",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"default special layer":arguments[0],t=arguments.length<=1||void 0===arguments[1]?{coord:{x:0,y:0},toLayer:!1}:arguments[1],n=t.coord||{x:0,y:0},i=new c.MapLayer(e,n);return i.specialLayer=!0,t.toLayer&&t.toLayer.addChild(i),i}},{key:"addLayer",value:function(e){var t;return this.getSubcontainerConfigs()&&e.subcontainers!==!1&&(e.subcontainers=this.getSubcontainerConfigs()),t=new a(e),this.getMovableLayer().addChild(t),t}},{key:"usesSubcontainers",value:function(){return!!this.getSubcontainerConfigs()}},{key:"getSubcontainerConfigs",value:function(){return this.subcontainersConfig}},{key:"getViewportArea",value:function(){var e,t,n,i=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],a=new s.Point(0,0),r=new s.Point(window.innerWidth,window.innerHeight);if(i){e=this.getMovableLayer();var o=e.toLocal(r),u=e.toLocal(a);n={x:u.x,y:u.y},t={x2:o.x,y2:o.y}}else e=this.getStaticLayer(),n={x:a.x,y:a.y},t={x2:r.x,y2:r.y};return{x:Math.round(n.x),y:Math.round(n.y),width:Math.round(Math.abs(Math.abs(t.x2)-n.x)),height:Math.round(Math.abs(Math.abs(t.y2)-n.y))}}},{key:"removeLayer",value:function(e){return n.removeChild(e),e}},{key:"moveMap",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{x:0,y:0}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?e:arguments[1],i={x:Math.round(e.x/this.getStaticLayer().getZoom()),y:Math.round(e.y/this.getStaticLayer().getZoom())};n.move(i),h.publish("mapMoved",t||i),this.drawOnNextTick()}},{key:"isCacheActivated",value:function(){return this.cache}},{key:"cacheMap",value:function(t){e(!0,this.usesSubcontainers())}},{key:"unCacheMap",value:function(){e(!1,this.usesSubcontainers())}},{key:"activatePlugins",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],n=[];return t.forEach(function(t){"object"===("undefined"==typeof t?"undefined":_typeof(t))?e.activatePlugin(t):d.error("problem with initializing a plugin: "+t.name)}),n}},{key:"activatePlugin",value:function(e){try{if(!e||!e.pluginName||!e.init)throw new Error("plugin, plugin.pluginName or plugin.init import is missing!");this.plugins.add(e[e.pluginName]),this.plugins.has(e[e.pluginName])&&e.init(this)}catch(t){d.error("An error initializing plugin. JSON.stringify: '"+JSON.stringify(e)+"' ",t)}}},{key:"setPrototype",value:function(e,t){var n=Object.getPrototypeOf(this);n[e]=t}},{key:"getObjectsUnderArea",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{x:0,y:0,width:0,height:0}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=t.filters,i=void 0===n?null:n,a={globalCoords:e,localCoords:this.getMovableLayer().toLocal(new s.Point(e.x,e.y))},r={};if(a.localCoords.width=e.width,a.localCoords.height=e.height,this.usesSubcontainers()){var o=this._getSubcontainersUnderArea(a,{filters:i});r=this._retrieveObjects(a,{subcontainers:o})}return r}},{key:"getPrimaryLayers",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.filters;return this.getMovableLayer().getPrimaryLayers({filters:t})}},{key:"getMapCoordinates",value:function(){return{x:this.getMovableLayer().x,y:this.getMovableLayer().y}}},{key:"getZoomLayer",value:function(){return this.getStaticLayer()}},{key:"setZoom",value:function(e){return this.getZoomLayer().setZoom(e),h.publish("mapZoomed",{previousScale:this.getZoom(),newScale:e}),e}},{key:"getZoom",value:function(){return this.getZoomLayer().getZoom()}},{key:"getMovableLayer",value:function(){return n}},{key:"getRenderer",value:function(){return i}},{key:"getStaticLayer",value:function(){return t}},{key:"zoomIn",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"zoomOut",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"toggleFullsize",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"toggleFullScreen",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"_retrieveObjects",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{type:"",subcontainers:[]}:arguments[1];return this.objectManager.retrieve(e,{type:t.type,subcontainers:t.subcontainers,size:{width:e.globalCoords.width,height:e.globalCoords.height}})}},{key:"_getLayersWithAttributes",value:function(e,t){return this.getMovableLayer().children[0].children.filter(function(n){return n[e]===t})}},{key:"_getSubcontainersUnderArea",value:function(e){var t,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=n.filters,a=this.getPrimaryLayers({filters:i}),r=[];return a.forEach(function(n){t=n.getSubcontainersByCoordinates(e.localCoords),r=r.concat(t)}),r}},{key:"_defaultTick",value:function(){var e,n,a=1e3,r=0,o=(new Date).getTime();s.ticker.shared.add(function(){b===!0&&(this.trackFPSCB&&(e=(new Date).getTime()),i.render(t),b=!1,this.trackFPSCB&&(n+=Math.round(Math.abs(e-(new Date).getTime())))),this.trackFPSCB&&(r++,o+a<(new Date).getTime()&&(this.trackFPSCB({FPS:r,FPStime:o,renderTime:n,drawCount:i.drawCount}),r=0,n=0,o=(new Date).getTime()))}.bind(this))}},{key:"_addObjectToUIlayer",value:function(e,t,n){switch(e){case g:this.getStaticLayer().addUIObject(t,n);break;case v:this.getMovableLayer().addUIObject(t,n)}}}]),r}();window.flatworld.Flatworld=m}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(){function e(e,r,s){var y=arguments.length<=3||void 0===arguments[3]?{trackFPSCB:!1,isHiddenByDefault:!0,cache:!1}:arguments[3];console.log("============== Horizontal hexagonal Map factory started =============");var d,f,l,p=n.environmentDetection.getPixelRatio(),h="string"==typeof r.map?JSON.parse(r.map):r.map,u="string"==typeof r.type?JSON.parse(r.type):r.type,m="string"==typeof r.game?JSON.parse(r.game):r.game,w=n.resize.getWindowSize(),b={refreshEventListeners:!0},g={ObjectTerrain:c.objects.ObjectHexaTerrain,ObjectUnit:c.objects.ObjectHexaUnit},x={bounds:{x:0,y:0,width:w.x,height:w.y},rendererOptions:{resolution:p,autoResize:!0,transparent:!0,antialias:!1},subcontainers:{width:500,height:500,maxDetectionOffset:100,isHiddenByDefault:y.isHiddenByDefault},trackFPSCB:y.trackFPSCB,cache:y.cache};return d=new a(e,x,b),f=document.getElementById("selectionDialog"),l=new s.init(f,d),o(l,d),h.layers.forEach(function(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw i.error("Problem in horizontalHexaFactory, with layerData:"+JSON.stringify(e)),new Error("Problem in horizontalHexaFactory, with layerData:",e);var r,a=d.getRenderer(),o={name:e.name,coord:e.coord,drawOutsideViewport:{x:a.width,y:a.height},selectable:"unitLayer"===e.name};try{r=d.addLayer(o),e.objectGroups.forEach(function(e){var a=e.typeImageData;return a?void e.objects.forEach(function(o){var n,c,s,y;try{if(n=u.objectData[a][o.objType],!n)throw i.error("Bad mapData for type:",a,o.objType,o.name),new Error("Bad mapData for type:",a,o.objType,o.name);s=t.Texture.fromFrame(n.image),c={data:{typeData:n,activeData:o.data},radius:m.hexagonRadius},y=new g[e.type](s,o.coord,c),r.addChild(y)}catch(d){i.error(d)}}):void i.error("Error with spritesheetType-data")})}catch(n){i.error("Problem:"+JSON.stringify(e.type)+" ---- "+JSON.stringify(n.stack))}}),d.moveMap(h.startPoint),d}var t=window.flatworld_libraries.PIXI,r=window.flatworld,a=r.Flatworld,o=r.UI,n=r.utils,i=r.log,c=window.flatworld.extensions.hexagons;window.flatworld.factories.hexaFactory=e}();
//# sourceMappingURL=flatworld.min.js.map
