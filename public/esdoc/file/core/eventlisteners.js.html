<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">core/eventlisteners.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/core/Map.js~Map.html">Map</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/core/Map_layers.js~Map_layer.html">Map_layer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/core/Map_layers.js~Map_parentLayer.html">Map_parentLayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/core/ObjectManager.js~ObjectManager.html">ObjectManager</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/core/Objects.js~Object_sprite.html">Object_sprite</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/core/Objects.js~Object_sprite_terrain.html">Object_sprite_terrain</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/core/Objects.js~Object_sprite_unit.html">Object_sprite_unit</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/core/UI_themeBase.js~UI_templateBase.html">UI_templateBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-UI">UI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-mapEvents">mapEvents</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">move</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-map_drag">map_drag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-pluginName">pluginName</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">utils</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/core/utils/Quadtree.js~Quadtree.html">Quadtree</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-dataManipulation">dataManipulation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-effects">effects</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-utils">utils</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-environmentDetection">environmentDetection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-general">general</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-mouse">mouse</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-resize">resize</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">zoom</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-map_zoom">map_zoom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-pluginName">pluginName</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">core/eventlisteners.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/* global Hammer, Hamster */

&apos;use strict&apos;;

/***********************
****** VARIABLES *******
***********************/
var stateOfEvents = {};
var singletonScope;

/***********************
********* API **********
***********************/
export { eventListenerModule as eventListeners };

/***********************
******** PUBLIC ********
***********************/
/**
 * Houses the default eventlisteners used in the map. When plugins are added to the map this class can be used for the eventlistener management. This way all the eventlisteners are in the same object, conveniently.
 * eventListeners is a singleton that needs to be initialized with an object, that holds all the callbacks used in this class. I.e.
 *  {
 *  select: function() {},
 *   zoom: function() {}
 * }
 *
 * @requires Hammer.js (for touch events)
 * @requires Hamster.js (for good cross-browser mousewheel events)
 * @param {HTML element} canvasElement          The canvas element we listen events from. Will try to search the first canvas in the DOM, if none is provided
 */
function eventListenerModule(canvasElement = document.getElementsByTagName(&quot;canvas&quot;)[0], refresh = false) {
  var CBs = {};
  var hammer, hamster;

  if (refresh) {
    singletonScope = undefined;
  }

  if (singletonScope) {
    return singletonScope;
  }

  if (!canvasElement) {
    throw new Error(&quot;eventlisteners initialization require map callbacks and canvas element as arguments&quot;);
  }

  hammer = new Hammer.Manager(canvasElement);
  hamster = new Hamster(canvasElement);
  /********** Required **********/

  singletonScope = {
    states: {}
  };

  /**
   * Sets the state of the event. State is so far very important for fluent dragging and selecting. When we start to drag, we avoid selecting units and vice versa, when we keep an event state tracking through this.
   *
   * @param {String} type         Event name we are following
   * @param {Boolean} state       The state we want to set (true or false)
   */
  singletonScope.setState = function setState(type, state) {
    stateOfEvents[type] = state;
  };
  /**
   * Gets the current state of the event
   *
   * @param  {String} type         Event name we are following
   * @return {Boolean}             returns true of false
   */
  singletonScope.getState = function setState(type) {
    return stateOfEvents[type];
  };

  /**
   * Sets the canvas to fullsize as in the same size of the window / content area. But not fullscreen
   *
   * @param {Function} cb     Callback that fires when this event activates
   * @return {Boolean}        Return the state of this event
   */
  singletonScope.toggleFullSizeListener = function toggleFullSizeListener(cb) {
    if ( !singletonScope.states.fullSize ) {
      CBs.fullSize = cb;
      cb();
      window.addEventListener(&quot;resize&quot;, CBs.fullSize);
    } else {
      window.removeEventListener(&quot;resize&quot;, CBs.fullSize);
    }

    singletonScope.states.fullSize = !singletonScope.states.fullSize;

    return singletonScope.states.fullSize;
  };
  /**
   * Sets the canvas to fullsize (as in fullSizeListener) and sets the browser in fullscreen mode
   *
   * @param {Function} cb     Callback that fires when this event activates
   * @return {Boolean}        Return the state of this event
   */
  singletonScope.toggleFullscreen = function toggleFullscreen(cb) {
    singletonScope.states.fullScreen = cb();

    return cb;
  };
  /**
   * Zoom the map. Mousewheel (desktop) and pinch (mobile)
   *
   * @param {Function} cb     Callback that fires when this event activates
   * @return {Boolean}        Return the state of this event
   */
  singletonScope.toggleZoomListener = function toggleZoomListener(cb) {
    CBs.zoom = cb;

    if (singletonScope.states.zoom !== true) {
      var pinch = new Hammer.Pinch();
      hammer.add(pinch);
      hammer.on(&quot;pinch&quot;, CBs.zoom);
      /* Hamster handles wheel events really nicely */
      hamster.wheel(CBs.zoom);
    } else {
      hammer.on(&quot;pinch&quot;, CBs.zoom);
      hamster.unwheel(CBs.zoom);
    }

    singletonScope.states.zoom = !singletonScope.states.zoom;

    return singletonScope.states.zoom;
  };
  /**
   * DragListener (normally used for moving the map)
   *
   * @param {Function} cb     Callback that fires when this event activates
   * @return {Boolean}        Return the state of this event
   */
  singletonScope.toggleDragListener = function toggleDragListener(cb) {
    var pan;

    CBs.drag = cb;

    if (singletonScope.states.drag !== true) {
      pan = new Hammer.Pan({
        pointers: 1,
        threshold: 5,
        direction:  Hammer.DIRECTION_ALL });
      hammer.add(pan);
      hammer.on(&quot;pan&quot;, CBs.drag);
    } else {
      hammer.off(&quot;pan&quot;, CBs.drag);
    }

    singletonScope.states.drag = !singletonScope.states.drag;

    return singletonScope.states.drag;
  };
  /**
   * Selecting something from the map
   *
   * @param {Function} cb     Callback that fires when this event activates
   * @return {Boolean}        Return the state of this event
   */
  singletonScope.toggleSelectListener = function toggleSelectListener(cb) {
    CBs.select = cb;

    if (singletonScope.states.select !== true) {
      var tap = new Hammer.Tap();
      hammer.add(tap);
      hammer.on(&quot;tap&quot;, CBs.select);
    } else {
      hammer.off(&quot;tap&quot;, CBs.select);
    }

    singletonScope.states.select = !singletonScope.states.select;

    return singletonScope.states.select;
  };

  return singletonScope;
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
