"use strict";window.flatworld_libararies={},window.flatworld_libararies.PIXI=window.PIXI,window.flatworld_libararies.Q=window.Q,window.flatworld_libararies.Hammer=window.Hammer,window.flatworld_libararies.hamster=window.hamster,window.flatworld_libararies.Handlebars=window.Handlebars,window.flatworld_libararies.loglevel=window.log,window.flatworld_libararies.Howler=window.Howl,window.flatworld={},window.flatworld.generalUtils={},window.flatworld.objects={},window.flatworld.extensions={},window.flatworld.mapLayers={},window.flatworld.utils={},window.flatworld.factories={},window.flatworld.UIs={},window.flatworld.UIs["default"]={};
"use strict";!function(){function r(){function r(){Array.prototype.find||(Array.prototype.find=function(r){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof r)throw new TypeError("predicate must be a function");for(var t,n=Object(this),o=n.length>>>0,e=arguments[1],i=0;o>i;i++)if(t=n[i],r.call(e,t,i,n))return t})}function t(){"function"!=typeof Object.assign&&!function(){Object.assign=function(r){if(void 0===r||null===r)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(r),n=1;n<arguments.length;n++){var o=arguments[n];if(void 0!==o&&null!==o)for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t}}()}function n(){String.prototype.repeat||!function(){var r=function(){try{var r={},t=Object.defineProperty,n=t(r,r,r)&&t}catch(o){}return n}(),t=function(r){if(null==this)throw TypeError();var t=String(this),n=r?Number(r):0;if(n!=n&&(n=0),0>n||n==1/0)throw RangeError();for(var o="";n;)n%2==1&&(o+=t),n>1&&(t+=t),n>>=1;return o};r?r(String.prototype,"repeat",{value:t,configurable:!0,writable:!0}):String.prototype.repeat=t}()}return{arrayFind:r,objectAssign:t,es6String:n}}window.flatworld.generalUtils.polyfills=r()}();
"use strict";!function(){function n(){function n(n){return[].concat.apply([],n)}return{flatten2Levels:n}}window.flatworld.generalUtils.arrays=n()}();
"use strict";!function(){function n(){function n(){var n=screen.width<=640||window.matchMedia&&window.matchMedia("only screen and (max-width: 640px)").matches,t="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;return t&&n}return{isMobile:n}}window.flatworld.generalUtils.environmentDetection=n()}();
"use strict";!function(){var l=window.flatworld_libararies.loglevel;l.enableAll(),window.flatworld.log={debug:function(e,o){l.debug(o,e)}}}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,n,a){return n&&e(r.prototype,n),a&&e(r,a),r}}();!function(){var e=window.flatworld_libararies.Q,r=window.flatworld_libararies.PIXI,n=function(){function n(e){var a=arguments.length<=1||void 0===arguments[1]?{concurrency:15,crossOrigin:!1}:arguments[1];_classCallCheck(this,n);var o=a.concurrency;this.preloaderClass=new r.loaders.Loader(e,o)}return _createClass(n,[{key:"resolveOnComplete",value:function(){var r=e.defer();return this.preloaderClass.load(),this.preloaderClass.once("complete",function(e,n){r.resolve(e,n)}),r.promise}},{key:"addResource",value:function(e){this.preloaderClass.add(e)}},{key:"loadManifest",value:function(){return this}},{key:"setErrorHandler",value:function(e){return this.preloaderClass.on("error",e),this}},{key:"setProgressHandler",value:function(e){return this.preloaderClass.on("error",e),this}},{key:"activateSound",value:function(){this.preloaderClass.installPlugin()}}]),n}();window.flatworld.Preload=n}();
"use strict";!function(){function t(){function t(t){return Object.keys(t).map(function(n){return t[n]})}function n(t){var n=[];return n.concat.apply(n,t)}return{mapObjectsToArray:t,flattenArrayBy1Level:n}}window.flatworld.utils.dataManipulation=t()}();
"use strict";!function(){function l(){function l(){var l=arguments.length<=0||void 0===arguments[0]?{color:"#000000",distance:5,alpha:.5,"amgÃ¶e":45,blur:5}:arguments[0],t=new PIXI.filters.DropShadowFilter;t.color=l.color,t.distance=l.distance,t.alpha=l.alpha,t.angle=l.angle,t.blur=l.blur,this.filters=[t]}return{dropShadow:l}}window.flatworld.utils.effects=l()}();
"use strict";!function(){function e(){function e(e){var n;return e=e?e:window.event,e.buttons?n=2===+e.buttons:e.which?n=3===+e.which:e.button&&(n=2===+e.button),!!n}function n(e){return{x:e.offsetX,y:e.offsetY}}function t(e){return e.center}function o(e){var n={x:0,y:0};return e||(e=window.event),e.pageX||e.pageY?(n.x=e.pageX,n.y=e.pageY):(e.clientX||e.clientY)&&(n.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),n}return{isRightClick:e,eventData:{getPointerCoords:n,getHAMMERPointerCoords:t},eventMouseCoords:o}}function n(){function e(){function e(e){var n=e.cancelFullScreen||e.webkitCancelFullScreen||e.mozCancelFullScreen||e.exitFullscreen;if(n)n.call(e);else if("undefined"!=typeof window.ActiveXObject){var t=new ActiveXObject("WScript.Shell");null!==t&&t.SendKeys("{F11}")}}function n(e){var n=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen;if(n)n.call(e);else if("undefined"!=typeof window.ActiveXObject){var t=new ActiveXObject("WScript.Shell");null!==t&&t.SendKeys("{F11}")}return!1}var t=document.body,o=document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen;return o?e(document):n(t),!1}function n(e){return function(){var n=t();e.canvas.width=n.x,e.canvas.height=n.y}}function t(){return{x:window.innerWidth,y:window.innerHeight}}return{toggleFullScreen:e,setToFullSize:n,getWindowSize:t}}function t(){function e(e){var n=window.devicePixelRatio||1,t=e&&e.getContext("2d")||document.createElement("canvas").getContext("2d"),o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/o}return{getPixelRatio:e}}function o(){function e(e,t){return Math.abs(e)-Math.abs(t)<n}var n=.01;return{pixelEpsilonEquality:e}}window.flatworld.utils.mouse=e(),window.flatworld.utils.resize=n(),window.flatworld.utils.environmentDetection=t(),window.flatworld.utils.general=o()}();
"use strict";!function(){function t(){function t(t,n){document.addEventListener(t,n),i[t]=0}function n(t){var n;if(n=(new Date).getTime(),i[t]+e<n){for(var r=new Event(t),a=arguments.length,u=Array(a>1?a-1:0),c=1;a>c;c++)u[c-1]=arguments[c];r.customData=u,document.dispatchEvent(r),i[t]=n}}var e=50,i={};return{subscribe:t,publish:n}}window.flatworld.mapEvents=t()}();
"use strict";!function(){function t(){function t(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(!o[t]&&!o[t].size)throw new Error("eventlisteners.on needs to have detector set with this event type!");o[t].on(a("Map"+t,e)),n[t]=n[t]||new Set,n[t].add(e)}function r(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];o[t].off(e),e?n[t]["delete"](e):delete n[t]}function v(){var t,e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],o=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return t=o?n[e].has(o):!!n[e].size}function f(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments[1];e[t]=n}function d(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e[t]}function l(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];o[t]={},o[t]={on:e,off:n}}function c(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];n[t].forEach(function(e){o[t].cbOff(e)}),delete n[t],delete o[t]}function a(t,e){return function(){i.publish(t),e.apply(void 0,arguments)}}return{on:t,off:r,isOn:v,setActivityState:f,getActivityState:d,setDetector:l,clearDetector:c}}var e={},n={},o={},i=window.flatworld.mapEvents;window.flatworld.eventListeners=t()}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _get=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();!function(){function e(e,t){var i,r=t.subcontainersConfig,n=t.subcontainerList,o=Math.floor(e.x/r.width),s=Math.floor(e.y/r.height);return n[o]=n[o]||[],i=n[o][s]=n[o][s]||[],n[o][s].length<=0&&(i=new a({x:o*r.width,y:s*r.height,width:r.width,height:r.height}),n[o][s]=i,i.x=o*r.width,i.y=s*r.height,i.visible=!r.isHiddenByDefault),e.x-=i.x,e.y-=i.y,n[o][s].addChild(e),n[o][s]}function t(e,t){for(var i=arguments.length<=2||void 0===arguments[2]?{filter:void 0}:arguments[2],r=i.filter,n={x:t.x>=0?t.x:0,y:t.y>=0?t.y:0,width:t.width,height:t.height},a=e.getSubcontainerConfigs(),o=a.width,s=a.height,l=[],c=Math.floor(n.x/o),u=Math.floor(n.y/s),h=n.width?n.x+n.width:+n.x,f=n.height?n.y+n.height:+n.y,y=Math.floor(h/o),d=Math.floor(f/s),v=e.subcontainerList,b=c;y>=b;b++)if(b>=0&&v&&v[b])for(var p=u;d>=p;p++)if(p>=0&&v[b][p]){if(r&&!r.filterSubcontainers(v[b][p]))continue;l.push(v[b][p])}return l}var i=[],r=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{name:"",coord:{x:0,y:0},specialLayer:!1,selectable:!1}:arguments[0];_classCallCheck(this,t);var i=e.name,r=e.coord,n=e.specialLayer,a=e.selectable,o=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return Object.assign(o,r),o.name=""+i,o.specialLayer=!!n,o.selectable=a,o}return _inherits(t,e),_createClass(t,[{key:"hasSubcontainers",value:function(){return!!this.subcontainersConfig}},{key:"isCached",value:function(){return this.cacheAsBitmap}},{key:"move",value:function(e){this.x+=e.x,this.y+=e.y,this.drawThisChild=!0}},{key:"setZoom",value:function(e){return this.scale.x=this.scale.y=+e.toFixed(2),this.scale.x}},{key:"getZoom",value:function(){return this.scale.x}},{key:"getUIObjects",value:function(){return i}},{key:"emptyUIObjects",value:function(){var e=this;return i.map(function(t){e.getUILayer().removeChild(t),t=null}),i}},{key:"getPrimaryLayers",value:function(){return this.children.filter(function(e){return!e.specialLayer})}},{key:"getObjects",value:function(){var e=[];return this.hasSubcontainers()&&this.subcontainerList.forEach(function(t){e.concat(t.children)}),e}},{key:"setCache",value:function(e){var t=!!e;return this.cacheAsBitmap=t,t}},{key:"createUILayer",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"default UI layer":arguments[0],i=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],r=new t(e,i);return r.specialLayer=!0,this.addChild(r),this.UILayer=r,r}},{key:"addUIObject",value:function(e){var t;return i=i||[],t=this.getUILayer()?this.getUILayer:this.createUILayer(),this.UILayer.addChild(e),i.push(e),i}},{key:"getUILayer",value:function(){return this.UILayer}}]),t}(PIXI.Container),n=function(i){function r(){var e=arguments.length<=0||void 0===arguments[0]?{name:"",coord:{x:0,y:0},subcontainers:!1,specialLayer:!1,selectable:!1}:arguments[0];_classCallCheck(this,r);var t=e.subcontainers,i=e.selectable,n=e.specialLayer,a=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return a.oldAddChild=_get(Object.getPrototypeOf(r.prototype),"addChild",a).bind(a),a.subcontainersConfig=t,a.subcontainerList=[],a.selectable=i,a.specialLayer=n,a}return _inherits(r,i),_createClass(r,[{key:"addChild",value:function(t){if(this.hasSubcontainers()){var i=void 0;i=e(t,this),this.oldAddChild(i)}else this.oldAddChild(t);return t}},{key:"getSubcontainerConfigs",value:function(){return this.subcontainersConfig}},{key:"getSubcontainersByCoordinates",value:function(e){var i=arguments.length<=1||void 0===arguments[1]?{filter:void 0}:arguments[1];if(!this.hasSubcontainers())throw new Error("tried to retrieve subcontainers, when they are not present");var r,n,a=i.filter;return n=this.toLocal(new PIXI.Point(e.x,e.y)),n.width=e.width,n.height=e.height,r=t(this,n,{filter:a})}},{key:"getSubcontainers",value:function(){return this.subcontainerList}}]),r}(r),a=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return i.specialLayer=!0,i.size=e,i.selectable=!1,i}return _inherits(t,e),_createClass(t,[{key:"getSubcontainerArea",value:function(e){var t,i=arguments.length<=1||void 0===arguments[1]?{toGlobal:!0}:arguments[1];return t=i.toGlobal?this.toGlobal(new PIXI.Point(0,0)):this,e&&(t.x/=e,t.y/=e),{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(this.size.width),height:Math.round(this.size.height)}}},{key:"setCache",value:function(e){var t=!!e;return this.cacheAsBitmap=t,t}}]),t}(PIXI.Container);window.flatworld.mapLayers=window.flatworld.mapLayers||{},window.flatworld.mapLayers.MapLayer=r,window.flatworld.mapLayers.MapLayerParent=n}();
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(a,t,r){return t&&e(a.prototype,t),r&&e(a,r),a}}();!function(){var e=window.flatworld.mapLayers,a=function(){function a(t){_classCallCheck(this,a),this.rules=Array.isArray(t)?t:[t],this.layerClasses=[e.MapLayer,e.MapLayerParent]}return _createClass(a,[{key:"filterSubcontainers",value:function(e){return Array.isArray(e)?void 0:this._runRules(e)}},{key:"addRule",value:function(e){this.rules.concat(e)}},{key:"_runRules",value:function(e){var a,t=this;return this.rules.forEach(function(r){if("filter"===r.type)switch(r.object){case"container":a=t._getContainer(e,r);break;case"object":a=t._getObject(e,r)}}),a}},{key:"_getContainer",value:function(e,a){return e&&(e.parent instanceof this.layerClasses[0]||e&&e.parent instanceof this.layerClasses[1])?e.parent[a.property]===a.value:e&&e.parent&&(e.parent.parent instanceof this.layerClasses[0]||e.parent.parent instanceof this.layerClasses[0])?e.parent.parent[a.property]===a.value:void 0}},{key:"_getContainer",value:function(e,a){return e&&(e.parent instanceof this.layerClasses[0]||e&&e.parent instanceof this.layerClasses[1])?e.parent[a.property]===a.value:e&&e.parent&&(e.parent.parent instanceof this.layerClasses[0]||e.parent.parent instanceof this.layerClasses[0])?e.parent.parent[a.property]===a.value:void 0}}]),a}();window.flatworld.MapDataManipulator=a}();
"use strict";!function(){function e(e,i){var o;if(n)return n;if(!e||!i)throw new Error("UI-module requires UITheme and map object");return o=i,n={},n.showSelections=function(n,i,o){return n=t(n),1===n.length?e.highlightSelectedObject(n[0],i):n.length>1?e.showSelections(n,i):"No objects found"},n.highlightSelectedObject=function(t,n,i){e.highlightSelectedObject(t)},n.showUnitMovement=function(t,n,i,o){e.showUnitMovement(t,n,i,o)},n}function t(e){var t=e.filter(function(e){return e.highlightable===!0});return t}var n;window.flatworld.UI=e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();!function(){var t=(window.flatworld.utils,window.flatworld.generalUtils.arrays,function(){function t(e){_classCallCheck(this,t),this.hitDetector=e||{}}return _createClass(t,[{key:"retrieve",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?{type:!1,subcontainers:[],size:{width:0,height:0}}:arguments[1],r=n.subcontainers,i=n.size,a=n.type,o=t.globalCoords,l=(t.localCoords,[]);return r.length>0&&(r.forEach(function(t){l=l.concat(t.children)}),i.width&&i.height||(l=l.filter(function(t){if(a&&a!==t.type)return!1;var n=t.hitTest?t.hitTest(o,{hitDetector:e.hitDetector}):!0;return n}))),l}}]),t}());window.flatworld.ObjectManager=t}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();!function(){var t=window.flatworld.utils,e=window.PIXI,n=function(t){function n(){var t=arguments.length<=0||void 0===arguments[0]?{x:0,y:0}:arguments[0],e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{currentFrame:{}}:arguments[2];_classCallCheck(this,n);var o=r.currentFrame,i=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,o)),a={x:Math.round(t.x),y:Math.round(t.y)};return i.position.set(a.x,a.y),i.name="Objects_sprite_"+i.id,i.type="None",i.highlightable=!0,i.data=e,i.currentFrame=o,i.areaWidth=i.width,i.areaHeight=i.height,i}return _inherits(n,t),_createClass(n,[{key:"innerDraw",value:function(t,e){return this.fromFrame(this.currentFrame),this.x=t,this.y=e,this}},{key:"drawNewFrame",value:function(t,e,n){return this.currentFrame=n,this.innerDraw(t,e)}},{key:"getGraphicalArea",value:function(){var t,n=arguments.length<=0||void 0===arguments[0]?{toGlobal:!0}:arguments[0];return t=n.toGlobal?this.toGlobal(new e.Point(0,0)):this,{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(this.width),height:Math.round(this.height)}}},{key:"localToLocal",value:function(t,e,n){var r=this.toGlobal({x:t,y:e}),o=n.toLocal(r);return o}},{key:"clone",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?{position:!1,anchor:!1}:arguments[1],r=new e.Sprite;return r.texture=this.generateTexture(t),n.anchor&&(r.anchor=Object.assign({},this.anchor)),n.position&&(r.position=Object.assign({},this.position)),r}}]),n}(e.Sprite),r=function(t){function e(t,n,r){_classCallCheck(this,e);var o=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,n,r));return o.name="DefaultTerrainObject",o.type="terrain",o.highlightable=!1,o}return _inherits(e,t),e}(n),o=function(e){function n(t,e,r){_classCallCheck(this,n);var o=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,t,e,r));return o.name="DefaultUnitObjects",o.type="unit",o.actions={move:[],attack:[]},o}return _inherits(n,e),_createClass(n,[{key:"doAction",value:function(t){this.actions[t].forEach(function(t){t()})}},{key:"addActionType",value:function(t){this.actions[t]=this.actions[t]||[]}},{key:"addCallbackToAction",value:function(t,e){this.actions[t].push(e)}},{key:"dropShadow",value:function(){var e;return(e=t.effects).dropShadow.apply(e,arguments)}}]),n}(n);window.flatworld.objects.ObjectSprite=n,window.flatworld.objects.ObjectSpriteTerrain=r,window.flatworld.objects.ObjectSpriteUnit=o}();
"use strict";function _classCallCheck(l,e){if(!(l instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function l(l,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(l,o.key,o)}}return function(e,n,o){return n&&l(e.prototype,n),o&&l(e,o),e}}();!function(){var l=window.flatworld_libararies.Q,e=window.flatworld_libararies.Howler,n=(window.flatworld.utils,window.flatworld.mapLayers,function(){function n(){_classCallCheck(this,n),this._allSounds={}}return _createClass(n,[{key:"add",value:function(l,n){var o=arguments.length<=2||void 0===arguments[2]?{loop:!1,volume:1}:arguments[2],a=o.loop,t=o.volume;return this._allSounds[l]={},this._allSounds[l]=new e({urls:[n],autoplay:!1,loop:a,volume:t}),this._allSounds[l]}},{key:"remove",value:function(l){delete this._allSounds[l]}},{key:"play",value:function(e){var n=l.defer();this._allSounds[e]._onend=function(){n.resolve(!0)},this._allSounds[e].play()}},{key:"stop",value:function(l){this._allSounds[l].stop()}},{key:"fade",value:function(e,n,o,a){var t,r=l.defer();return t=function(){r.resolve(!0)},this._allSounds[e].fade(n,o,a,t),r.promise}}]),n}());window.flatworld.Sound=n}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}();!function(){var e,n,t=function(){function t(a){_classCallCheck(this,t),n=a,e=this.addStyleElement();var r="\n        "+n.select+" {\n          z-index: 9999;\n          opacity: 0.9;\n          position: fixed;\n          left: 0px;\n          bottom: 0px;\n          background-color: brown;\n          border: 1px solid rgb(255, 186, 148);;\n          border-bottom: 0px;\n          padding:15px;\n          margin-left:10px;\n        }";this.addCSSRulesToScriptTag(e,r)}return _createClass(t,[{key:"getStyleSheetElement",value:function(){return e}},{key:"getCSSClasses",value:function(){return n}},{key:"addCSSRulesToScriptTag",value:function(e,n){e.insertRule(n,0)}},{key:"addStyleElement",value:function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}},{key:"showModal",value:function(e,n){e.classList.add(n.select)}}]),t}();window.flatworld.UITemplateBase=t}();
"use strict";!function(){function n(){function n(n){s=new Hammer.Manager(n.canvas),c=new Hamster(n.canvas),e.setDetector("fullSize",t().on,t().off),e.setDetector("fullscreen",o().on,o().off),e.setDetector("zoom",r().on,r().off),e.setDetector("drag",f().on,f().off),e.setDetector("select",i().on,i().off),n.setPrototype("setFullsize",function(){u=u||n._resizeCanvas.bind(n),e.on("fullSize",u)}),n.setPrototype("setFullScreen",function(){e.on("fullscreen",n._setFullScreen.bind(n))})}function t(){return{on:function(n){window.addEventListener("resize",n)},off:function(n){window.removeEventListener("resize",n)}}}function o(){return{on:function(n){window.addEventListener("fullscreen",n)},off:function(n){window.removeEventListener("fullscreen",n)}}}function r(){return{on:function(n){var e=new Hammer.Pinch;s.add(e),s.on("pinch",n),c.wheel(n)},off:function(n){s.on("pinch",n),c.unwheel(n)}}}function f(){return{on:function(n){var e=new Hammer.Pan({pointers:1,threshold:5,direction:Hammer.DIRECTION_ALL});s.add(e),s.on("pan",n)},off:function(n){s.off("pan",n)}}}function i(){return{on:function(n){var e=new Hammer.Tap;s.add(e),s.on("tap",n)},off:function(n){s.off("tap",n)}}}var s,c,u;return{init:n,pluginName:"baseEventlisteners"}}var e=window.flatworld.eventListeners;window.flatworld.extensions.baseEventlisteners=n()}();
"use strict";!function(){function t(){function t(t){a=r(t),n.on("drag",a)}function r(t){var r=!1;return function(i){var a;return n.getActivityState("zoom")?!1:(a=e.mouse.eventData.getHAMMERPointerCoords(i),u=!0,a.x=Math.round(a.x),a.y=Math.round(a.y),r?(i.isFinal===!0&&(r=!1,u=!1),void o(i,t,a)):(f.setOffset({x:a.x,y:a.y}),void(r=!0)))}}function o(t,n,e){var r,o;r=f.getOffset(),o={x:e.x-r.x,y:e.y-r.y},o.x>0||o.y>0||o.x<0||o.y<0?n.moveMap(o):u=!1,f.setOffset({x:e.x,y:e.y}),t.preventDefault()}function i(){function t(t){return e=t}function n(){return e}var e;return{setOffset:t,getOffset:n}}var a,f=i(),u=!1;return{init:t,pluginName:"mapDrag",_startDragListener:r}}var n=window.flatworld.eventListeners,e=window.flatworld.utils;window.flatworld.extensions.mapDrag=t()}();
"use strict";!function(){function o(){function o(o){v=o,v.setPrototype("zoomIn",i),v.setPrototype("zoomOut",a),v.setPrototype("setZoomLimits",r),v.setPrototype("setZoomModifier",n),t.on("zoom",s)}function n(o){if(!(o>0||.5>=o))throw new Error("Wrong zoom modifier! (needs to be >0 and <=0.5, given:"+o);return h=o,this}function r(o,t){return d.farther=o,d.closer=t,this}function i(o){var t=this.getZoom(),e=!0;return p(this,t,Math.abs(o)||h,e)}function a(o){var t=this.getZoom(),e=!1;return o=0>o?o:-o,p(this,t,o||-h,e)}function s(o,t,e,r){t?m(o,t,e,r):o.pointers&&(w||(w=!0,n(.5*h)),u(o))}function m(o,t,e,n){var r=n,i=v.getZoom();o.preventDefault(),r>0?v.zoomIn()&&v.moveMap(c(i,!0),c(v.getZoom(),!0)):0>r&&v.zoomOut()&&v.moveMap(c(i),c(v.getZoom()))}function u(o){var e=o.pointers,n=[{x:e[0].pageX,y:e[0].pageY},{x:e[1].pageX,y:e[1].pageY}],r=Math.abs(n[0].x-n[1].x),i=Math.abs(n[0].y-n[1].y);o.preventDefault();try{if(!l)return g={x:r,y:i},t.setActivityState("zoom",!0),void(l=!0);4!==o.eventType&&8!==o.eventType||(window.setTimeout(function(){t.setActivityState("zoom",!1)},y),l=!1),g.x+g.y<r+i?v.zoomIn()&&v.moveMap(c(v.getZoom(),!0)):v.zoomOut()&&v.moveMap(c(v.getZoom())),g={x:r,y:i}}catch(a){console.log("Error! ",a)}}function f(o,t){return!!(t&&o>d.closer||!t&&o<d.farther)}function c(o,t){var n=e.resize.getWindowSize(),r={x:n.x/2/o,y:n.y/2/o},i={x:r.x*(t?-h:h),y:r.y*(t?-h:h)};return i}function p(o,t,e,n){var r;return f(t,n)||(r=o.setZoom(e?t+e:t+h)),r}var v,y=40,l=!1,w=!1,g={},d={farther:.4,closer:2.5},h=.1;return{init:o,pluginName:"mapZoom"}}var t=window.flatworld.eventListeners,e=window.flatworld.utils;window.flatworld.mapEvents;window.flatworld.extensions.mapZoom=o()}();
"use strict";window.flatworld.extensions.hexagons={},window.flatworld.extensions.hexagons.utils={},window.flatworld.extensions.hexagons.eventlisteners={};
"use strict";!function(){function n(n){var t,o=arguments.length<=1||void 0===arguments[1]?"radius":arguments[1],i=arguments.length<=2||void 0===arguments[2]?3:arguments[2];return i=Math.round(i),"radius"===o&&(t=n*Math.sqrt(3)),Number(t.toFixed(i))}function t(n){var t,o=arguments.length<=1||void 0===arguments[1]?"radius":arguments[1],i=arguments.length<=2||void 0===arguments[2]?3:arguments[2];return"radius"===o&&(t=2*n),Number(t.toFixed(i))}function o(n){var t,o=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],e=arguments.length<=2||void 0===arguments[2]?{x:0,y:0}:arguments[2];return t=n.map(function(n){return{x:n.x+e.x,y:n.y+e.y}}),i(o,t)}function i(n,t){for(var o,i,e,r,a,u=n.x,l=n.y,s=!1,d=0,x=t.length-1;d<t.length;x=d++)o=t[d].x,e=t[d].y,i=t[x].x,r=t[x].y,a=e>l!=r>l&&(i-o)*(l-e)/(r-e)+o>u,a&&(s=!s);return s}window.flatworld.extensions.hexagons.utils.calcShortDiagonal=n,window.flatworld.extensions.hexagons.utils.calcLongDiagonal=t,window.flatworld.extensions.hexagons.utils.hexaHitTest=o}();
"use strict";!function(){function n(n){var o=(arguments.length<=1||void 0===arguments[1]?{isFlatTop:!1}:arguments[1],[]);return o=t(n),new PIXI.Polygon(o)}function o(n){var o=arguments.length<=1||void 0===arguments[1]?{color:"#000000",isFlatTop:!1}:arguments[1],i=new PIXI.Graphics,e=t(n);return i.beginFill(o.color,1),i.drawPolygon(e),i.endFill(),i}function t(n){return i(n).map(function(n){return new PIXI.Point(n.x,n.y)})}function i(n){var o=arguments.length<=1||void 0===arguments[1]?{isFlatTop:!1,precision:3}:arguments[1],t=o.isFlatTop?0:.5,i={x:n,y:n},e=2*Math.PI/6*t,a=i.x*Math.cos(e),r=i.y*Math.sin(e),s=[];s.push({x:a,y:r});for(var l=1;7>l;l++)e=2*Math.PI/6*(l+t),a=i.x*Math.cos(e),r=i.y*Math.sin(e),s.push({x:a,y:r});return s}window.flatworld.extensions.hexagons.utils.createHexagon=n,window.flatworld.extensions.hexagons.utils.createVisibleHexagon=o}();
"use strict";!function(){function t(t){function i(n){var o,i,w=e.mouse.eventData.getHAMMERPointerCoords(n),s={allData:function(t){return t.data.typeData}};i=new r({type:"filter",object:"container",property:"name",value:"unitLayer"}),o=t.getObjectsUnderArea(w,{filter:i}),o=e.dataManipulation.mapObjectsToArray(o),o=e.dataManipulation.flattenArrayBy1Level(o),o.length&&a.publish("objectsSelected",o),l.showSelections(o,s),t.drawOnNextTick()}var l;if(!t)throw new Error("eventlisteners initialization require map arguments");return l=n(),o.on("select",i),!0}var e=window.flatworld.utils,a=window.flatworld.mapEvents,n=window.flatworld.UI,r=window.flatworld.MapDataManipulator,o=window.flatworld.eventListeners;window.flatworld.extensions.hexagons.setupHexagonClick=t}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(){function t(t){if(!t)throw new Error("Need radius!");var n=Math.round(s(t)),r=Math.round(c(t)),o=Math.round(t.toFixed(3));this.anchor.set(.5,.5),this.areaHeight=this.HEIGHT=n,this.areaWidth=this.WIDTH=r,this.SIDE=o,this.ROW_HEIGHT=Math.round(.75*n),this.hitArea=e(t),this.hitTest=function(t,e){this.updateTransform();var n=e.hitDetector.processInteractive(new PIXI.Point(t.x,t.y),this,function(){console.log("Shouldn't get here, the object should be non-interactive")},!0,!0);return n}}function e(t){return n||(n=u(t)),n}var n,r=window.flatworld.objects,o=r.ObjectSpriteTerrain,i=r.ObjectSpriteUnit,a=window.flatworld.extensions.hexagons.utils,s=a.calcLongDiagonal,c=a.calcShortDiagonal,u=a.createHexagon,l=function(e){function n(e,r,o){_classCallCheck(this,n);var i=o.radius,a=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,r,o));return a.name="DefaultTerrainObject_hexa",t.call(a,i),a}return _inherits(n,e),n}(o),h=function(e){function n(e,r,o){_classCallCheck(this,n);var i=o.radius,a=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,r,o));return a.name="DefaultUnitObjects_hexa",t.call(a,i),a}return _inherits(n,e),n}(i);window.flatworld.extensions.hexagons.objects={ObjectHexaTerrain:l,ObjectHexaUnit:h}}();
"use strict";!function(){function n(){function n(n){o=n,t(o)}function t(n){return e(n)}var o={};return{init:n,pluginName:"selectHexagonObject"}}var e=window.flatworld.extensions.hexagons.setupHexagonClick;window.flatworld.extensions.hexagons.selectHexagonObject=n()}();
"use strict";!function(){function t(){function t(t){f=t,g=f.getZoom(),a(),o(),f.drawOnNextTick(),window.FlaTWorld_mapMovement_subCheck=function(){f.getPrimaryLayers().forEach(function(t){var n,e,a=i.flatten2Levels(t.getSubcontainers());n=a.filter(function(t){return t.visible}),e=a.filter(function(t){return!t.visible}),console.log("visible subcontainers: "+n.length+":"+n,"\n\ninvisible: "+e.length+":"+e)})},window.FlaTWorld_mapMovement_deactivate=function(){f.getPrimaryLayers().forEach(function(t){var n,e=i.flatten2Levels(t.getSubcontainers());n=e.forEach(function(t){t.visible=!1})})}}function a(){var t;t=f.getViewportArea(),Object.assign(t,u(t)),Object.assign(t,s(t,g)),f.getPrimaryLayers().forEach(function(n){var e=i.flatten2Levels(n.getSubcontainers());e.forEach(function(n){n.visible=!h(n,t,!1)})})}function r(){function t(t,n){var e,i,a,r;e=f.getViewportArea(),i=c(e,.5),Object.assign(e,c(e)),a=s(e),r=s(i),d(a,r)}if(M.processing)return!1;M.processing=!0;var n=t(M,v);window.setTimeout(n,w)}function o(){function t(t){var n=t.customData[0];v.width+=n.x,v.height+=n.y,r(f)}function n(){r(f)}function i(t){g=t.customData[0].newScale}e.subscribe("mapMoved",t),e.subscribe("mapResized",n),e.subscribe("mapZoomed",i)}function h(t,e){var i,a,r=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];return a=t.getSubcontainerArea(g,{toGlobal:r}),i=!n(a,e)}function u(t){var n=Math.abs(t.width*l*2);return{x2:Math.round(t.x+Math.abs(t.width)+n),y2:Math.round(t.y+Math.abs(t.height)+n),width:Math.round(t.width+n),height:Math.round(t.height+n)}}function s(t){return{x:Math.round(t.x/g),y:Math.round(t.y/g),x2:Math.round(t.x2/g),y2:Math.round(t.y2/g),width:Math.round(t.width/g),height:Math.round(t.height/g)}}function d(t,n){var e,a=[];e=Object.assign({},t),e.width+=Math.round(Math.abs(v.width)),e.height+=Math.round(Math.abs(v.height)),v.width=0,v.height=0,a=f.getPrimaryLayers().map(function(t){return t.getSubcontainersByCoordinates(e)}),a=i.flatten2Levels(a),a.forEach(function(t){h(t,n,!0)?t.visible=!1:t.visible=!0}),M.processing=!1,f.drawOnNextTick()}function c(t,n){var e=Math.abs(t.width*l);return n=n||1,{x:Math.round(t.x-e*n),y:Math.round(t.y-e*n),x2:Math.round(t.x+Math.abs(t.width)+e*n),y2:Math.round(t.y+Math.abs(t.height)+e*n),width:Math.round(t.width+2*e*n),height:Math.round(t.height+2*e*n)}}function s(t){return{x:Math.round(t.x/g),y:Math.round(t.y/g),x2:Math.round(t.x2/g),y2:Math.round(t.y2/g),width:Math.round(t.width/g),height:Math.round(t.height/g)}}var f,g,l=.8,w=20,M={},v={width:0,height:0};return{init:t,pluginName:"mapMovement",addAll:a,check:r,startEventListeners:o}}function n(t,n){return t.x<=n.x+n.width&&n.x<=t.x+t.width&&t.y<=n.y+n.height&&n.y<=t.y+t.height}var e=window.flatworld.mapEvents,i=window.flatworld.generalUtils.arrays;new Worker("/components/map/extensions/mapMovement/mapMovementWorker.js");window.flatworld.extensions.mapMovement=t()}();
"use strict";window.flatworld.UIs=window.flatworld.UIs||{},window.flatworld.UIs["default"]={},window.flatworld.UIs["default"].utils={},window.flatworld.UIs["default"].layout={};
"use strict";!function(){window.flatworld.UIs["default"].utils=window.flatworld.UIs["default"].utils||{},window.flatworld.UIs["default"].utils.drawShapes=function(){function t(t,a,e,n,o,i,s,r,h){function f(t,a,e,n,o,i,s,r){var h;switch(a=+a,e=+e,n=+n,o=+o,i=+i,s=+s,t.beginStroke("#F00").moveTo(a,e).lineTo(n,o).lineTo(i,s),r){case 0:h=Math.sqrt((i-a)*(i-a)+(s-e)*(s-e)),t.arcTo(n,o,a,e,.55*h),t.fill();break;case 1:t.beginStroke("#F00").moveTo(a,e).lineTo(n,o).lineTo(i,s).lineTo(a,e).fill();break;case 2:break;case 3:var f=(a+n+i)/3,M=(e+o+s)/3;t.beginFill().quadraticCurveTo(f,M,a,e);break;case 4:var d,c,l,u,p=5;if(i===a)h=s-e,d=(n+a)/2,l=(n+a)/2,c=o+h/p,u=o-h/p;else{h=Math.sqrt((i-a)*(i-a)+(s-e)*(s-e));var y=(a+i)/2,v=(e+s)/2,b=(y+n)/2,T=(v+o)/2,g=(s-e)/(i-a),w=h/(2*Math.sqrt(g*g+1))/p,I=g*w;d=b-w,c=T-I,l=b+w,u=T+I}t.bezierCurveTo(d,c,l,u,a,e),t.fill()}}var M,d,c,l,u,p,y=t.graphics,v="#000";"string"==typeof a&&(a=parseInt(a,10)),"string"==typeof e&&(e=parseInt(e,10)),"string"==typeof n&&(n=parseInt(n,10)),"string"==typeof o&&(o=parseInt(o,10)),i="undefined"!=typeof i?i:3,s="undefined"!=typeof s?s:1,r="undefined"!=typeof r?r:Math.PI/8,h="undefined"!=typeof h?h:10;var b,T,g,w,I="function"!=typeof i?f:i,k=Math.sqrt((n-a)*(n-a)+(o-e)*(o-e)),q=(k-h/3)/k;1&s?(b=Math.round(a+(n-a)*q),T=Math.round(e+(o-e)*q)):(b=n,T=o),2&s?(g=a+(n-a)*(1-q),w=e+(o-e)*(1-q)):(g=a,w=e),y.beginStroke(v).moveTo(g,w).lineTo(b,T);var P=Math.atan2(o-e,n-a),S=Math.abs(h/Math.cos(r));return 1&s&&(M=P+Math.PI+r,d=n+Math.cos(M)*S,c=o+Math.sin(M)*S,l=P+Math.PI-r,u=n+Math.cos(l)*S,p=o+Math.sin(l)*S,I(y,d,c,n,o,u,p,i)),2&s&&(M=P+r,d=a+Math.cos(M)*S,c=e+Math.sin(M)*S,l=P-r,u=a+Math.cos(l)*S,p=e+Math.sin(l)*S,I(y,d,c,a,e,u,p,i)),!0}function a(a,e,n,o,i,s,r,h,f,M,d){var c,l,u,p,y;h="undefined"!=typeof h?h:3,f="undefined"!=typeof f?f:1,M="undefined"!=typeof M?M:Math.PI/8,d="undefined"!=typeof d?d:10,a.beginPath(),a.arc(e,n,o,i,s,r),a.stroke(),a.strokeStyle="rgba(0,0,0,0)",1&f&&(c=Math.cos(i)*o+e,l=Math.sin(i)*o+n,u=Math.atan2(e-c,l-n),r?(p=c+10*Math.cos(u),y=l+10*Math.sin(u)):(p=c-10*Math.cos(u),y=l-10*Math.sin(u)),t(a,c,l,p,y,h,2,M,d)),2&f&&(c=Math.cos(s)*o+e,l=Math.sin(s)*o+n,u=Math.atan2(e-c,l-n),r?(p=c-10*Math.cos(u),y=l-10*Math.sin(u)):(p=c+10*Math.cos(u),y=l+10*Math.sin(u)),t(a,c,l,p,y,h,2,M,d))}return{normal:t,arced:a}}()}();
"use strict";!function(){var l=window.flatworld_libararies.Handlebars;window.flatworld.UIs=window.flatworld.UIs||{},window.flatworld.UIs["default"]=window.flatworld.UIs["default"]||{},window.flatworld.UIs["default"].templates={multiSelection:l.compile("\n      <span style='font-size:200%;display:block;margin-bottom:20px;'>\n        {{title}}\n      </span>\n      <ul>\n        {{#each objects}}\n        <li>\n          {{this.data.typeData.name}}\n        </li>\n        {{/each}}\n      </ul>"),singleSelection:l.compile("\n      <span style='font-size:200%;display:block;margin-bottom:20px;'>\n        {{title}}\n      </span>\n      <ul>\n        <li>\n          {{object.name}}\n        </li>\n      </ul>")}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}();!function(){function e(e){if(!i[e]){var t=$(l[e]);i[e]=t}return i[e]}var t=window.flatworld.UIs["default"].templates,o=window.flatworld.extensions.hexagons.utils.createVisibleHexagon,n=window.flatworld.UITemplateBase,a=(window.flatworld.UI,"slow"),l={select:"#dialog_select"},i={},r=function(n){function i(e,t){var o=arguments.length<=2||void 0===arguments[2]?{styles:"#F0F0F0"}:arguments[2];_classCallCheck(this,i);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,l));return n.map=t,n.modal=e||document.getElementById("dialog_select"),n.styles=o.styles,n}return _inherits(i,n),_createClass(i,[{key:"getTemplates",value:function(){return t}},{key:"showSelections",value:function(o,n,i){var r,s=this,c=this.map.drawOnNextTick.bind(this.map),h=this.map.getMovableLayer();r=o&&o.length>1?function(){s.modal.innerHTML=t.multiSelection({title:"Objects",objects:o}),s.showModal(s.modal,l),console.log(o),e("select").fadeIn(a)}:1===o.length?function(){s.highlightSelectedObject(o[0]),console.log(o)}:function(){h.emptyUIObjects(),c(),console.log("Error occured selecting the objects on this coordinates! Nothing found")},e("select").fadeOut(a,r)}},{key:"highlightSelectedObject",value:function(o,n){var i,r,s=arguments.length<=2||void 0===arguments[2]?{shadow:{color:"0x0000",distance:5,alpha:.55,angle:45,blur:5}}:arguments[2],c=s.shadow;return r=n.allData(o),this.modal.innerHTML=t.singleSelection({title:"Selected",object:{name:r.name}}),this.showModal(this.modal,l),i=this._highlightSelectedObject(o,this.map.getRenderer()),i.dropShadow({color:c.color,distance:c.distance,alpha:c.alpha,angle:c.angle,blur:c.blur}),this.map.drawOnNextTick(),e("select").fadeIn(a),i}},{key:"showUnitMovement",value:function(){}},{key:"init",value:function(){}},{key:"_highlightSelectedObject",value:function(e,t){var o,n=this.map.getMovableLayer();o=e.clone(t),o.__proto__=e.__proto__;var a=e.toGlobal(new PIXI.Point(0,0));return a=n.toLocal(a),a.x-=e.width*e.anchor.x,a.y-=e.height*e.anchor.y,this.createHighlight(o,{coords:a}),o}},{key:"createHighlight",value:function(e){var t,n=arguments.length<=1||void 0===arguments[1]?{coords:new PIXI.Point(0,0)}:arguments[1],a=47,l=this.map.getMovableLayer(),i=new this.map.createSpecialLayer("UILayer",{toLayer:l}),r={x:Number(e.x),y:Number(e.y)};t=o(a,{color:"#F0F0F0"}),t.x=r.x+32,t.y=r.y+27,t.alpha=.5,i.addChild(t),i.addChild(e),i.position=n.coords,this.map.removeUIObject(this.map.layerTypes.movableType.id,[i]),this.map.addUIObjects(this.map.layerTypes.movableType.id,[i])}}]),i}(n);window.flatworld.UIs["default"].init=r}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(){function e(e,t){t?n.children.forEach(function(t){if(!t.isCached())return!1;var n=t.getSubcontainers();n.forEach(function(t){t.setCache(e)})}):n.children.forEach(function(t){return t.isCached()?void t.setCache(e):!1})}var t,n,i,a,r=window.flatworld_libararies.Q,o=window.flatworld.mapLayers,l=(window.flatworld.Objects,window.flatworld.ObjectManager),u=window.flatworld.mapEvents,s=window.flatworld.utils,c=window.flatworld.MapDataManipulator,h=0,d=1,y="0.0.1",g=!1,v=[],f=function(){function f(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],r=arguments.length<=1||void 0===arguments[1]?{bounds:{width:0,height:0},rendererOptions:{refreshEventListeners:!0},subcontainers:!1,cache:!1,trackFPSCB:!1}:arguments[1];_classCallCheck(this,f);var u=r.bounds,s=r.rendererOptions,c=r.subcontainers,g=r.trackFPSCB,v=r.cache;if(!e)throw new Error(this.constructor.name+" needs canvasContainer!");"string"==typeof e&&(e=document.querySelector(e)),i=PIXI.autoDetectRenderer(u.width,u.height,s),i.plugins.interaction.destroy(),e.innerHTML="",e.appendChild(i.view,e),a=c?o.MapLayerParent:o.MapLayer,t=new o.MapLayer({name:"staticLayer",coord:{x:0,y:0}}),n=new o.MapLayer({name:"movableLayer",coord:{x:0,y:0}}),t.addChild(n),i.view.style.position="absolute",i.view.style.display="block",i.view.style.left="0px",i.view.style.top="0px",document.getElementsByTagName("body")[0].style.overflow="hidden",i.roundPixels=!0,this.canvas=i.view,this.plugins=new Set,this.subcontainersConfig=c,this.trackFPSCB=g,this.objectManager=new l(new PIXI.interaction.InteractionManager(i)),this.cache=v,this.layerTypes={staticType:{id:h,layer:t},movableType:{id:d,layer:n}},this.VERSION=y}return _createClass(f,[{key:"init",value:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],i=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=arguments.length<=3||void 0===arguments[3]?{fullsize:!0}:arguments[3],r=[];return a.fullsize&&this.toggleFullsize(),e.length&&(r=this.activatePlugins(e)),t&&Object.assign(n,t),this._defaultTick(),i&&this.customTickOn(i),v=r,this.cache&&this.cacheMap(),this.drawOnNextTick(),r||Promise.resolve()}},{key:"whenReady",value:function(){return r.all(v)}},{key:"drawOnNextTick",value:function(){g=!0}},{key:"addUIObject",value:function(e,t){switch(e){case h:this.getStaticLayer().addUIObject(t);break;case d:this.getMovableLayer().addUIObject(t)}}},{key:"removeUIObject",value:function(e,t){switch(e){case h:this.getStaticLayer().emptyUIObjects();break;case d:this.getMovableLayer().emptyUIObjects()}}},{key:"addUIObjects",value:function(e,t){var n=this;t.forEach(function(t){n.addUIObject(e,t)})}},{key:"createSpecialLayer",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"default special layer":arguments[0],t=arguments.length<=1||void 0===arguments[1]?{coord:{x:0,y:0},toLayer:toLayer}:arguments[1],n=t.coord||{x:0,y:0},i=new o.MapLayer(e,n);return i.specialLayer=!0,t.toLayer&&t.toLayer.addChild(i),i}},{key:"addLayer",value:function(e){var t;return this.getSubcontainerConfigs()&&e.subcontainers!==!1&&(e.subcontainers=this.getSubcontainerConfigs()),t=new a(e),this.getMovableLayer().addChild(t),t}},{key:"usesSubcontainers",value:function(){return!!this.getSubcontainerConfigs()}},{key:"getSubcontainerConfigs",value:function(){return this.subcontainersConfig}},{key:"getViewportArea",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=e?this.getMovableLayer():this.getStaticLayer();return{x:t.x,y:t.y,width:Math.round(window.innerWidth),height:Math.round(window.innerHeight)}}},{key:"removeLayer",value:function(e){return n.removeChild(e),e}},{key:"moveMap",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{x:0,y:0}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?e:arguments[1],i={x:Math.round(e.x/this.getStaticLayer().getZoom()),y:Math.round(e.y/this.getStaticLayer().getZoom())};n.move(i),u.publish("mapMoved",t||i),this.drawOnNextTick()}},{key:"isCacheActivated",value:function(){return this.cache}},{key:"cacheMap",value:function(t){e(!0,this.usesSubcontainers())}},{key:"unCacheMap",value:function(){e(!1,this.usesSubcontainers())}},{key:"activatePlugins",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],n=[];return t.forEach(function(t){if("object"!==("undefined"==typeof t?"undefined":_typeof(t)))throw new Error("problem with initializing a plugin");e.activatePlugin(t)}),n}},{key:"activatePlugin",value:function(e){try{if(!e||!e.pluginName||!e.init)throw new Error("plugin, plugin.pluginName or plugin.init import is missing!");this.plugins.add(e[e.pluginName])&&e.init(this)}catch(t){console.log("An error initializing plugin. JSON.stringify: '"+JSON.stringify(e)+"' ",t)}}},{key:"setPrototype",value:function(e,t){var n=Object.getPrototypeOf(this);n[e]=t}},{key:"getObjectsUnderArea",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{x:0,y:0,width:0,height:0}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{filter:void 0}:arguments[1],n=t.filter,i={globalCoords:e,localCoords:this.getMovableLayer().toLocal(new PIXI.Point(e.x,e.y))},a={};if(i.localCoords.width=e.width,i.localCoords.height=e.height,n){var r=new c({type:"filter",object:"container",property:"selectable",value:!0});n.addRule(r)}if(this.usesSubcontainers()){var o=this._getSubcontainersUnderArea(i,{filter:n});a=this._retrieveObjects(i,{subcontainers:o})}return a}},{key:"getPrimaryLayers",value:function(){return this.getMovableLayer().getPrimaryLayers()}},{key:"getMapCoordinates",value:function(){return{x:this.getMovableLayer().x,y:this.getMovableLayer().y}}},{key:"getZoomLayer",value:function(){return this.getStaticLayer()}},{key:"setZoom",value:function(e){return u.publish("mapZoomed",{previousScale:this.getZoom(),newScale:e}),this.getZoomLayer().setZoom(e)}},{key:"getZoom",value:function(){return this.getZoomLayer().getZoom()}},{key:"getMovableLayer",value:function(){return n}},{key:"getRenderer",value:function(){return i}},{key:"getStaticLayer",value:function(){return t}},{key:"zoomIn",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"zoomOut",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"toggleFullsize",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"toggleFullScreen",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"_retrieveObjects",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{type:"",subcontainers:[]}:arguments[1];return this.objectManager.retrieve(e,{type:t.type,subcontainers:t.subcontainers,size:{width:e.globalCoords.width,height:e.globalCoords.height}})}},{key:"_getLayersWithAttributes",value:function(e,t){return this.getMovableLayer().children[0].children.filter(function(n){return n[e]===t})}},{key:"_getSubcontainersUnderArea",value:function(e){var t,n=arguments.length<=1||void 0===arguments[1]?{filter:void 0}:arguments[1],i=this.getMovableLayer().getPrimaryLayers(),a=[],r=n.filter;return i.forEach(function(n){t=n.getSubcontainersByCoordinates(e.globalCoords,{filter:r}),a=a.concat(t)}),a}},{key:"_setFullScreen",value:function(){s.resize.toggleFullScreen(),u.publish("mapResized"),this._resizeCanvas()}},{key:"_resizeCanvas",value:function(){var e=s.resize.getWindowSize();i.autoResize=!0,i.resize(e.x,e.y),u.publish("mapResized"),this.drawOnNextTick()}},{key:"_defaultTick",value:function(){var e,n,a=1e3,r=0,o=(new Date).getTime();PIXI.ticker.shared.add(function(){g===!0&&(this.trackFPSCB&&(e=(new Date).getTime()),i.render(t),g=!1,this.trackFPSCB&&(n+=Math.round(Math.abs(e-(new Date).getTime())))),this.trackFPSCB&&(r++,o+a<(new Date).getTime()&&(this.trackFPSCB({FPS:r,FPStime:o,renderTime:n,drawCount:i.drawCount}),r=0,n=0,o=(new Date).getTime()))}.bind(this))}}]),f}();window.flatworld.Flatworld=f}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(){function e(e,c){var l=arguments.length<=2||void 0===arguments[2]?{trackFPSCB:!1,isHiddenByDefault:!0,cache:!1}:arguments[2];console.log("============== Horizontal hexagonal Map factory started =============");var d,s,y,f=i.environmentDetection.getPixelRatio(),p="string"==typeof c.map?JSON.parse(c.map):c.map,w="string"==typeof c.type?JSON.parse(c.type):c.type,u="string"==typeof c.game?JSON.parse(c.game):c.game,m=i.resize.getWindowSize(),h=(u.mapSize,{refreshEventListeners:!0}),b={ObjectTerrain:a.objects.ObjectHexaTerrain,ObjectUnit:a.objects.ObjectHexaUnit},g={bounds:{x:0,y:0,width:m.x,height:m.y},rendererOptions:{resolution:f,autoResize:!0,transparent:!0,antialias:!1},subcontainers:{width:500,height:500,maxDetectionOffset:100,isHiddenByDefault:l.isHiddenByDefault},trackFPSCB:l.trackFPSCB,cache:l.cache};return d=new r(e,g,h),s=document.getElementById("selectionDialog"),y=new o(s,d),n(y,d),p.layers.forEach(function(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw console.log("Problem in horizontalHexaFactory, with layerData:",e),new Error("Problem in horizontalHexaFactory, with layerData:",e);var o,a=(e.group,d.objectManager,d.getRenderer()),r={name:e.name,coord:e.coord,drawOutsideViewport:{x:a.width,y:a.height},selectable:"unitLayer"===e.name};try{o=d.addLayer(r),e.objectGroups.forEach(function(e){var a=e.typeImageData;return a?void e.objects.forEach(function(r){var n,i,c,l,d;try{if(n=w.objectData[a][r.objType],!n)throw console.debug("Bad mapData for type:",a,r.objType,r.name),new Error("Bad mapData for type:",a,r.objType,r.name);i={typeData:n,activeData:r.data},l=t.Texture.fromFrame(n.image),c={currentFrame:l,radius:u.hexagonRadius},d=new b[e.type](r.coord,i,c),o.addChild(d)}catch(s){console.log(s)}}):void console.log("Error with spritesheetType-data")})}catch(n){console.log("Problem:",e.type,n.stack)}}),d.moveMap(p.startPoint),d}var t=window.flatworld_libararies.PIXI,o=window.flatworld.UIs["default"].init,a=window.flatworld.extensions.hexagons,r=window.flatworld.Flatworld,n=window.flatworld.UI,i=window.flatworld.utils;window.flatworld.factories.hexaFactory=e}();
//# sourceMappingURL=flatworld.min.js.map
